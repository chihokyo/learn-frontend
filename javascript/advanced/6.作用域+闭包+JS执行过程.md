# é—­åŒ…ï¼ˆClosure ï¼‰+ä½œç”¨åŸŸï¼ˆScopeï¼‰

ä¸ºä»€ä¹ˆè¦è¿™æ ·å†™å‘¢ï¼Ÿ

æœ€è¿‘åœ¨é‡æ–°å­¦ä¹  JavaScript æˆ‘è¯´ä¸€ä¸‹å§ã€‚æ¯”å¦‚è¯´é—­åŒ…ï¼Œä¸ºä»€ä¹ˆå¾ˆéš¾ç†è§£å‘¢ï¼Ÿå› ä¸ºæˆ‘åŸæ¥ç”¨çš„éƒ½æ˜¯é¢å‘å¯¹è±¡çš„æ€ç»´ï¼Œé¢å‘å¯¹è±¡æ˜¯å•¥æ€ç»´ï¼Œå°±æ˜¯å°è£…çš„æ—¶å€™æœ‰**ç§æœ‰å˜é‡**ï¼Œæœ‰**å…¬å…±å˜é‡**ã€‚

> ä½†æ˜¯ JavaScript å¾ˆä¸å¹¸çš„æ²¡æœ‰ç§æœ‰å˜é‡è¿™ä¸ªç©æ„å„¿ã€‚

å…¶å®å†è°ˆé—­åŒ…ä¹‹å‰è¿™äº›éƒ½æ˜¯éœ€è¦ç†è§£çš„ï¼Œå¦‚æœè¿™äº›ä¸ç†è§£å…¶å®å¾ˆéš¾å»ç†è§£é—­åŒ…ã€‚

- ä½œç”¨åŸŸæ˜¯ä»€ä¹ˆ
- ä½œç”¨åŸŸçš„æå‡
- å‡½æ•°åœ¨å†…å­˜ä¸­çš„æ‰§è¡Œ
- é—­åŒ…æ˜¯ä»€ä¹ˆ
- é—­åŒ…åœ¨å†…å­˜ä¸­çš„æ‰§è¡Œ
- é—­åŒ…å®é™…ä½¿ç”¨åœºæ™¯

## 1 ä½œç”¨åŸŸ

### 1-1 ä»€ä¹ˆæ˜¯ä½œç”¨åŸŸï¼Ÿ

ä»€ä¹ˆæ˜¯ä½œç”¨åŸŸï¼Œå°±æ˜¯å®šä¹‰äº†**å˜é‡**çš„**è®¿é—®**èŒƒå›´ã€‚ ç®€å•çš„è¯´å°±æ˜¯è°èƒ½ç¢°åˆ°ä½ ï¼Œè°èƒ½è®¿é—®åˆ°ä½ çš„é—®é¢˜ã€‚

> ä»€ä¹ˆæ˜¯ä½œç”¨åŸŸï¼Œå°±æ˜¯å®šä¹‰äº†å˜é‡çš„è®¿é—®èŒƒå›´ã€‚

ä»€ä¹ˆæ˜¯ä½œç”¨åŸŸï¼Œå°±æ˜¯å®šä¹‰äº†å˜é‡çš„è®¿é—®èŒƒå›´ã€‚

- å…¨å±€ä½œç”¨åŸŸ
- å‡½æ•°ä½œç”¨åŸŸ
- å—çŠ¶ä½œç”¨åŸŸï¼ˆES6 ä¹‹å‰æ²¡æœ‰å—çŠ¶ä½œç”¨åŸŸçš„ï¼‰

![image-20220519202001259](https://raw.githubusercontent.com/chihokyo/image_host/develop/image-20220519202001259.png)

ğŸ‘‡ğŸ» æœ‰ä¸€éƒ¨åˆ†æ˜¯å‡ºè‡ª javascript info ä¸Šçš„è§£é‡Š

```js
/**
 * åœ¨å¤–é¢æ— æ³•è®¿é—®çš„
 */
{
  let msg = 'hello';
  console.log(msg);
}
console.log(msg); // ReferenceError: msg is not defined

/**
 * æ‰€ä»¥å°±ç‹¬è‡ªç¾å¥½
 */
{
  let msg = 'hello';
  console.log(msg);
}

{
  let msg = 'world';
  console.log(msg);
}

/**
 * å¦‚æœæˆ‘ä»¬ä½¿ç”¨ let å¯¹å·²å­˜åœ¨çš„å˜é‡è¿›è¡Œé‡å¤å£°æ˜ï¼Œå¦‚æœå¯¹åº”çš„å˜é‡æ²¡æœ‰å•ç‹¬çš„ä»£ç å—ï¼Œåˆ™ä¼šå‡ºç°é”™è¯¯ï¼š
 */
let msg = 'hello';
let msg = 'world'; // variable already declared
```

å¯¹äº `if`ï¼Œ`for` å’Œ `while` ç­‰ï¼Œåœ¨ `{...}` ä¸­å£°æ˜çš„å˜é‡ä¹Ÿä»…åœ¨å†…éƒ¨å¯è§

```js
for (let i = 0; i < 3; i++) {
  // å˜é‡ i ä»…åœ¨è¿™ä¸ª for å¾ªç¯çš„å†…éƒ¨å¯è§
  alert(i); // 0ï¼Œç„¶åæ˜¯ 1ï¼Œç„¶åæ˜¯ 2
}

alert(i); // Error, no such variable
```

è¿™é‡Œå’Œ php å¯¹æ¯”ä¸€ä¸‹,php æ˜¯ä¸å¯èƒ½åœ¨å¤–é¢å®šä¹‰ä¸€ä¸ªæ™®é€šå˜é‡ç„¶åè¢«è®¿é—®åˆ°çš„ã€‚

```js
/**
 * JSæ˜¯å¯ä»¥è®¿é—®cname
 */
let cname = 'chin';
function show() {
  console.log(cname);
}
show(); // chin

/**
 * PHPæ ¹æœ¬ä¸å¯ä»¥è®¿é—®
 */
$cname = 'chin';
function show() {
  var_dump($cname);
}
show(); // undefined variable:cname
```

### 1-2 var çš„ç‰¹æ®Šæ€§

var åªæœ‰å‡½æ•°ä½œç”¨åŸŸå’Œå…¨å±€ä½œç”¨åŸŸï¼Œæ²¡æœ‰å—çŠ¶ä½œç”¨åŸŸã€‚

```js
if (true) {
  var cname = 'chin';
}
console.log(cname); // âœ… chin å› ä¸ºvarè¿™ä¸ªæ—¶å€™å°±æ˜¯å…¨å±€ä½œç”¨åŸŸ

if (true) {
  let cname = 'chin';
}
console.log(cname); // âŒ æ˜¾ç¤ºé”™è¯¯ å› ä¸ºletå°±æ˜¯å—çº§ä½œç”¨åŸŸ è€Œvaræ²¡æœ‰

{
  var a = 10;
}

console.log(a); // 19 å› ä¸ºvaræ²¡æœ‰å—çŠ¶ä½œç”¨åŸŸ
```

ä½†æ˜¯åœ¨å‡½æ•°çº§åˆ«çš„ä½œç”¨åŸŸä¸Šæ˜¯ä¸€æ ·çš„

```js
// åœ¨å‡½æ•°ä½œç”¨åŸŸçš„è¡¨ç°ä¸Š varå’Œletéƒ½æ˜¯ä¸€æ ·çš„
function show() {
  var cname = 'chin';
  console.log(cname);
}
console.log(cname); // ReferenceError: cname is not defined

function show() {
  let cname = 'chin';
  console.log(cname);
}
console.log(cname); // ReferenceError: cname is not defined
```

é¡ºä¾¿å¯¹æ¯”ä¸€ä¸‹ï¼Œè¿™ä¸¤æ®µä»£ç ã€‚

ä¸ºä»€ä¹ˆä¼šæŠ¥é”™ã€‚

```js
function show() {
  var cname = 'chin';
}
show();
console.log(cname); // æŠ¥é”™

function show() {
  cname = 'chin';
}
show();
console.log(cname); // chin
```

![image-20230210003627809](https://raw.githubusercontent.com/chihokyo/image_host/develop/image-20230210003627809.png)

### 1-3 ä½œç”¨åŸŸæå‡

å…¶å®è¿™ä¸ªä½œç”¨åŸŸæå‡çš„é—®é¢˜æ€ä¹ˆè¯´å‘¢ï¼Ÿ

è¿™é‡Œæœ‰ MDN å…³äºè¿™æ®µé—®é¢˜çš„è§£é‡Š [Hoistingï¼šå˜é‡æå‡](https://developer.mozilla.org/en-US/docs/Glossary/Hoisting)

```javascript
// å‡½æ•°æ˜¯å¯ä»¥è¢«å˜é‡æå‡çš„
// æ²¡å®šä¹‰å°±æå‰è°ƒç”¨ï¼Ÿç“¦ç‰¹ï¼Ÿæˆ‘ä»¬JavaScriptå½“ç„¶å¯ä»¥ï¼ğŸ¤ª
catName('Tiger');

function catName(name) {
  console.log("My cat's name is " + name);
}
```

å…¶å®ä¸Šé¢å°±æ˜¯ä¸€ä¸ªå˜é‡æå‡é—®é¢˜ï¼Œä¸€ä¸ªå˜é‡åœ¨ä½ å£°æ˜ä¹‹å‰ï¼Œä½ å°±è°ƒç”¨äº†ï¼Œè¿™å½“ç„¶å°±æ˜¯æå‡äº†ï¼

æ¯”å¦‚ä¸‹é¢

```js
// éªŒè¯ä¸€ä¸‹

//  âœ… æå‰è°ƒç”¨OKçš„
foo(); // Statement
function foo() {
  console.log('Statement');
}

// âŒ ä¸å¯ä»¥æå‰è°ƒç”¨
foo(); // ReferenceError
const foo = () => {
  console.log('Expressions');
};
```

ä½†æ˜¯è¿™ä¸ªé—®é¢˜æ˜¯æ€ä¹ˆäº§ç”Ÿçš„å‘¢ï¼Ÿè¿™å°±æ¶‰åŠåˆ° JavaScript ä»£ç åœ¨å†…å­˜ä¸­æ˜¯å¦‚ä½•è¿›è¡Œæ‰§è¡Œçš„é—®é¢˜äº†ã€‚

## 2 å…·ä½“å‡½æ•°çš„æ‰§è¡Œ

é¦–å…ˆè¦æ˜ç™½å‡ ä¸ªå•è¯æ¦‚å¿µå§ã€‚

**ã€1ã€‘Execution Context Stack** æ‰§è¡Œä¸Šä¸‹æ–‡è°ƒç”¨æ ˆ ã€ä¿è¯ JS ä»£ç æŒ‰ç…§ä¸€å®šé¡ºåºæ‰§è¡Œã€‘

> åŸºæœ¬ä¸Šå‡½æ•°æ‰§è¡Œéƒ½éœ€è¦ stack è¿™ä¸ªæ•°æ®ç»“æ„ï¼Œä¸ºä»€ä¹ˆï¼Ÿå› ä¸ºä»–æ˜¯ LIFOï¼Œå…ˆè¿›åå‡ºã€‚

![Stack Data Structure and Implementation in Python, Java and C/C++](https://cdn.programiz.com/sites/tutorial2program/files/stack.png)

**ã€2ã€‘Global Execution Context** å…¨å±€æ‰§è¡Œä¸Šä¸‹æ–‡

ğŸ‘† åªè¦æœ‰ JS ä»£ç  ã€å…¨å±€ä»£ç æ•´ä½“è¦æ‰§è¡Œ å°±è¦æœ‰ä¸Šä¸‹æ–‡ã€‘

**ã€3ã€‘Functional Execution Context** å‡½æ•°æ‰§è¡Œä¸Šä¸‹æ–‡ ã€å’Œå…¨å±€ä»£ç ä¸€æ · åŒç†ã€‘

**ã€4ã€‘Activation Object** AO AO ä¸­åŒ…å«å½¢å‚ã€argumentsã€å‡½æ•°å®šä¹‰å’ŒæŒ‡å‘å‡½æ•°å¯¹è±¡ã€å®šä¹‰çš„å˜é‡ã€‚

> ä¸Šé¢çš„æ¦‚å¿µåœ¨ä¸‹é¢éƒ½æœ‰è§£æã€‚

### ä»£ç æ®µ 1 æ— å‡½æ•°

> å¼•æ“ä¼šåœ¨æ‰§è¡Œä»£ç ä¹‹å‰ï¼Œä¼šåœ¨å †å†…å­˜ä¸­åˆ›å»ºä¸€ä¸ªå…¨å±€å¯¹è±¡:Global Object(GO)
>
> â†’ è¯¥å¯¹è±¡ æ‰€æœ‰çš„ä½œç”¨åŸŸ(scope)éƒ½å¯ä»¥è®¿é—®
>
> â†’ é‡Œé¢ä¼šåŒ…å« Dateã€Arrayã€Stringã€Numberã€setTimeoutã€setInterval ç­‰ç­‰
>
> â†’ å…¶ä¸­è¿˜æœ‰ä¸€ä¸ª window å±æ€§æŒ‡å‘è‡ªå·±

![image-20220519160333160](https://raw.githubusercontent.com/chihokyo/image_host/develop/image-20220519160333160.png)

> ä»€ä¹ˆæ˜¯ä½œç”¨åŸŸæå‡å‘¢ï¼Ÿ
>
> å…¶å®å°±æ˜¯ä¸Šé¢çš„åœ¨**è§£æé˜¶æ®µ**ï¼Œä»£ç è¿˜æ²¡æ‰§è¡Œçš„æ—¶å€™ã€‚ä½ å¯ä»¥çœ‹åˆ° GO é‡Œé¢å·²ç»æœ‰å½“å‰å…¨å±€æ‰€æœ‰çš„å˜é‡åˆå§‹åŒ–äº†ã€‚è™½ç„¶éƒ½æ˜¯ undefined çš„å§ã€‚é‡è¦çš„äº‹æƒ…è¯´ä¸‰éï¼**è§£æé˜¶æ®µè§£æé˜¶æ®µè§£æé˜¶æ®µ**ï¼ï¼ï¼
>
> æ‰€ä»¥è¿™å°±è§£é‡Šäº†ä¸‹é¢çš„ä»£ç 

```javascript
var name = 'chin';
console.log(foo); // è™½ç„¶è¿˜æ²¡å£°æ˜ å´æœ‰äº†ã€‚è¿™å°±æ˜¯ä½œç”¨åŸŸæå‡
var foo = 1;
```

é¡ºä¾¿ GO ä¹Ÿæ˜¯å¯ä»¥ç¡®è®¤çš„ åœ¨ `console.log(window)` å°±å¯ä»¥æ‰¾åˆ°ã€‚

### ä»£ç æ®µ 2 æœ‰å‡½æ•°

ä¸‹é¢ä¸€æ®µä»£ç æ˜¯æ€ä¹ˆæ‰§è¡Œçš„å‘¢ï¼Ÿ

è¿™é‡Œå…ˆå¼•å…¥ä¸€ä¸ªå®šä¹‰ Functional Execution Context å‡½æ•°æ‰§è¡Œä¸Šä¸‹æ–‡ ï¼ŒFEC åŒ…æ‹¬

- **A**ctivation **O**bject å¯¹è±¡ï¼ˆåŒ…å½¢å‚ã€argumentsã€å‡½æ•°å®šä¹‰å’ŒæŒ‡å‘å‡½æ•°å¯¹è±¡ã€å®šä¹‰çš„å˜é‡ï¼‰
- **S**cope **C**hain ä½œç”¨åŸŸé“¾ ï¼ˆè‡ªèº« AO + parentScope çˆ¶çº§ä½œç”¨åŸŸï¼Œå¦‚æœçˆ¶çº§æ²¡æœ‰ï¼Œå°±ç»§ç»­æ²¿ç€ä¸Šä¸€å±‚ç»§ç»­ï¼Œç›´åˆ°æ‰¾åˆ°ä¸ºæ­¢ï¼Œæ²¡æ‰¾åˆ°å°±æ˜¯æœªå®šä¹‰é”™è¯¯ ï¼‰
- this æŒ‡å‘ï¼ˆè¿™ä¸ªæ˜¯è¿è¡Œæ‰çŸ¥é“çš„ï¼Œè¿™ä¸ªå¯ä»¥å…ˆæ— è§†æ‰ï¼‰

```javascript
// 2ï¸âƒ£ ä»£ç çš„æ‰§è¡Œè¿‡ç¨‹ï¼ˆæœ‰å‡½æ•°ï¼‰
var id = 'chin';

foo(123);
function foo(num) {
  console.log(m);
  var m = 10;
  var n = 20;

  console.log(id);
}

console.log(aa);
```

- ç¼–è¯‘é˜¶æ®µ

  è¿™é‡Œå‡½æ•°çš„ AO ä¹Ÿä¾ç„¶æ˜¯åœ¨ç¼–è¯‘é˜¶æ®µçš„ï¼Œåªæ˜¯æ˜¯åœ¨`foo()`æ‰§è¡Œä¹‹åï¼Œæ­¤æ—¶ä¸€æ—¦æ‰§è¡Œå°±ç”Ÿæˆäº†ä¸€ä¸ª FEC æŠ¼å…¥åˆ° stack é‡Œé¢ï¼Œç„¶åè¿›è¡Œç¼–è¯‘åˆ›å»º AOï¼Œæ­¤æ—¶ `foo()`è¿˜æ²¡æœ‰æ‰§è¡Œã€‚

  ![image-20220519171647105](https://raw.githubusercontent.com/chihokyo/image_host/develop/image-20220519171647105.png)

ä¸‹é¢å¼€å§‹æ‰§è¡Œï¼Œæ‰§è¡Œé˜¶æ®µæœ‰ç‚¹å¤æ‚ã€‚ç›´æ¥ä¹Ÿå†™äº†ç¼–è¯‘ã€‚

![image-20220519173657455](https://raw.githubusercontent.com/chihokyo/image_host/develop/image-20220519173657455.png)

> æ›´æ–°ï¼Œå‡½æ•°è¦ä¼˜å…ˆäºæ‰€æœ‰å˜é‡è¿›è¡Œè§£æã€‚æ‰€ä»¥å³ä½¿å˜é‡å†™åœ¨å‰é¢ï¼Œå‡½æ•°ä¹Ÿä¸ä¼šè¦†ç›–å˜é‡ã€‚ä½†æ˜¯å˜é‡ä¼šè¦†ç›–å‡½æ•°ã€‚

```js
var foo = 'foo';
function foo() {
  console.log('function foo');
}

// è™½ç„¶fooå®šä¹‰åœ¨å‰é¢ï¼Œä½†æ˜¯å‡½æ•°fooæ˜¯ä¸€å®šä¼šæå‰è¢«è§£æçš„
// æ‰€ä»¥å‡½æ•°æœ€åè¢«è¦†ç›–æ‰äº†
```

### ä»£ç æ®µ 3 æœ‰å‡½æ•°ï¼ˆåµŒå¥— 1ï¼‰

ä¸‹é¢ä¸€æ®µä»£ç çš„å¥‡å¹»æ—…ç¨‹ï¼ˆæ‰§è¡Œè¿‡ç¨‹ï¼‰ã€‚

```javascript
var msg = 'hello global';
function foo() {
  console.log(msg);
}
function bar() {
  var msg = 'hello bar';
  foo();
}
bar(); // hello global
```

> è¿™é‡Œæˆ‘åªæ˜¯å…ˆç”»ä¸€ä¸ªæ•´ä½“æµç¨‹å›¾ï¼Œä¸åŒ…å«ç»†èŠ‚ã€‚

æ€»ä½“è¯´ 1 å°±æ˜¯ç¼–è¯‘é˜¶æ®µç”Ÿæˆçš„ï¼Œå…¶ä»–éƒ½æ˜¯é™†ç»­ç”Ÿæˆçš„ã€‚

ç¼–è¯‘é˜¶æ®µ â†’ åˆå«**è¯æ³•è§£æ**ï¼Œè¯æ³•è§£æçš„æ—¶å€™ç¡®å®šäº†çˆ¶çº§ä½œç”¨åŸŸã€‚

é‚£ä¹ˆä»€ä¹ˆæ˜¯è¯æ³•è§£æï¼Œå…¶å®æˆ‘æ„Ÿè§‰è¿™ä¸ªå®šä¹‰å°±æ˜¯å’Œè¿è¡Œç›¸å¯¹çš„ï¼Œä¸€ä¸ªä¸ºåŠ¨ï¼Œä¸€ä¸ªä¸ºé™ã€‚

**è¯æ³•è§£æçš„æ„æ€å°±æ˜¯ä¸€ä¸ªå‡½æ•°çš„å˜é‡è·Ÿåœ¨å“ªé‡Œå®šä¹‰æœ‰å…³ã€‚** æ˜¯é™æ­¢çš„çŠ¶æ€ï¼Œä¸€ä¸ªç¨‹åºé™æ­¢çš„æ—¶å€™æ€ä¹ˆçœ‹å…³ç³»å‘¢ï¼Œè¿˜ä¸æ˜¯å‡ºç”Ÿåœ¨å“ªé‡Œå°±æ˜¯å“ªé‡Œçš„äººã€‚å®Œå…¨å’Œè¿è¡Œæ— å…³çš„ã€‚åˆä¸æ˜¯ thisï¼

![image-20220326232628199](https://raw.githubusercontent.com/chihokyo/image_host/develop/image-20220326232628199.png)

## 3 é—­åŒ…å‡½æ•°åˆæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ

è¿™é‡Œåœ¨ç»è¿‡æˆ‘åˆçœ‹äº†å‡ ä¸ªè§†é¢‘ä¹‹åï¼Œæˆ‘å¯¹é—­åŒ…åˆæœ‰äº†æ–°çš„è®¤è¯†ã€‚é¦–å…ˆä½ è¦çŸ¥é“é—­åŒ…çš„å«ä¹‰å°±è¦çŸ¥é“ JavaScript é‡Œé¢å‡½æ•°çš„æ‰§è¡Œé¡ºåºï¼Œä½œç”¨åŸŸï¼Œä½œç”¨åŸŸé“¾è¿™äº›å†…å®¹ã€‚çŸ¥é“è¿™äº›å†…å®¹ä½ æ‰èƒ½æ‡‚å¾—ã€‚

- é—­åŒ…ä¸€å®šè·Ÿå‡½æ•°æœ‰å…³ï¼ˆæ²¡æœ‰å‡½æ•°å°±æ²¡æœ‰é—­åŒ…ï¼‰
- é—­åŒ…æ˜¯åŸºäºå˜é‡ä½œç”¨åŸŸæ— æ³•ä»å¤–è®¿é—®åˆ°å†…çš„å˜é‡çš„ç‰¹æ€§å†³å®šï¼Œä½ åªèƒ½é€šè¿‡**å‡½æ•°**è®¿é—®ï¼æ— æ³•ç›´æ¥è®¿é—®å˜é‡ï¼
- é—­åŒ…äº§ç”Ÿè·Ÿ**å‡½æ•°**å‡ºç”Ÿåœ°æœ‰å…³ã€‚

```javascript
let f; // è™½ç„¶fä¹‹å‰å°±å£°æ˜äº†ï¼Œä½†æ˜¯ä½ æ²¡ã€è¯ç”Ÿã€‘
const g = function () {
  const a = 23;
  // få‡½æ•°çš„å‡ºå£°å°±ä¼´éšç€ä»–ä¸€ç³»åˆ—çš„ç¯å¢ƒï¼Œæ­¤æ—¶å°±æ˜¯a
  // å› ä¸ºfè¿™ä¸ªå‡½æ•°è·Ÿaè¿™ä¸ªå˜é‡åœ¨aæ˜¯å‡½æ•°å°±ç»‘å®šäº†
  f = function () {
    console.log(a * 2);
  };
};

g(); // gæ‰§è¡Œå®Œä¹‹åæ‰€æœ‰ç©æ„å„¿åº”è¯¥æ¶ˆå¤±æ‰å¯¹ï¼Ÿ
f(); // 46 åˆ©ç”¨äº†é—­åŒ…ï¼Œä½ æ‰èƒ½ä»å¤–åˆ°å†…è®¿é—®åˆ°ä¸€ä¸ªå˜é‡ï¼Œä¹Ÿå°±æ˜¯aã€‚é‚£é€šè¿‡ä»€ä¹ˆè®¿é—®å‘¢ï¼Ÿè¯ç”Ÿä¸€ä¸ªæ–°å‡½æ•°f
```

å¦‚æœå®åœ¨ä¸æ‡‚ï¼Œå¯ä»¥é—®è‡ªå·±å‡ ä¸ªé—®é¢˜

- æˆ‘å¦‚ä½•ä»å¤–éƒ¨ï¼ˆå…¨å±€ï¼‰æ‹¿åˆ°å†…éƒ¨çš„ä¸€ä¸ªå˜é‡ aï¼Ÿâ€» æŒ‰ç…§å¸¸ç†è¯´ âš ï¸ ä»å¤–ä¸èƒ½åˆ°å†…çš„ï¼
- `g()`å‡½æ•°éƒ½æ‰§è¡Œå®Œäº†ï¼Œæ€ä¹ˆåé¢çš„`f()`è¿˜èƒ½è®¿é—®åˆ°å˜é‡ aï¼Ÿï¼Ÿï¼Ÿ
- ä¸ºä»€ä¹ˆ f æ˜æ˜æå‰å°±å£°æ˜äº†ï¼Œä½†æ˜¯é‡Œé¢è¿˜èƒ½ç»‘å®šå˜é‡ a å½¢æˆä¸€ä¸ªé—­åŒ…ï¼Ÿ

è¿™é‡ŒåŒæ—¶åœ¨ç»™ä¸€æ®µä»£ç ï¼Œè¯æ˜äº†é—­åŒ…æ°¸è¿œä¸ä¼šæ–­è¿ä»–çš„å‡ºç”Ÿåœ°ï¼Œå³ä½¿å·²ç»é‡ç”Ÿã€‚

```javascript
let f;
const g = function () {
  const a = 23;
  // å› ä¸ºfè¿™ä¸ªå‡½æ•°è·Ÿaè¿™ä¸ªå˜é‡åœ¨aæ˜¯å‡½æ•°å°±ç»‘å®šäº†
  f = function () {
    console.log(a * 2); // 46
  };
};

const h = function () {
  const b = 888;
  // æ°¸è¿œè·Ÿè‡ªå·±å‡ºç”Ÿåœ°æœ‰å…³ï¼Œå³ä½¿è¢«é‡æ–°èµ‹å€¼äº†
  // ä¹Ÿä¾ç„¶è·Ÿbæœ‰å…³è”
  // ğŸ†• é‡ç”Ÿäº† é‡æ–°èµ‹å€¼
  f = function () {
    console.log(b * 2);
  };
};

g();
f();
console.dir(f);

h();
f(); // 1776
console.dir(f);
```

ä½ å¯ä»¥ç®€å•çš„ç†è§£ä¸€ä¸‹ï¼Œ

### 3-1 å›è°ƒå‡½æ•°

![image-20220519150756550](https://raw.githubusercontent.com/chihokyo/image_host/develop/image-20220327231220222.png)

æˆ‘è¯´ä¸€ä¸‹å§ï¼Œå› ä¸ºè¿™ä¹Ÿæ¶‰åŠåˆ°å›è°ƒå‡½æ•°çš„é—®é¢˜ã€‚

> **æ‰€æœ‰çš„å›è°ƒå‡½æ•°éƒ½ä¼šäº§ç”Ÿé—­åŒ…ï¼Œå› ä¸ºå›è°ƒå‡½æ•°æ¯ä¸€æ¬¡éƒ½æ˜¯åœ¨æŸä¸ªå‡½æ•°é‡Œé¢è¯ç”Ÿçš„ï¼ï¼ï¼**

å›è°ƒå‡½æ•°å…¶å®å°±æ˜¯ç”¨çš„**é—­åŒ…æ¥å®ç°è®¿é—®å†…éƒ¨çš„æ•°æ®**çš„ã€‚

å›è°ƒå‡½æ•°ä¼ å…¥çš„å‚æ•°æ˜¯å‡½æ•° â†’ å‡½æ•°æ‰“å…¥å†…éƒ¨æ‹¿ä½ çš„è´¢äº§ï¼ˆè¿™å°±æ˜¯é—­åŒ…çš„ä½œç”¨ï¼‰ â†’ ä½ æ‹¿åˆ°äº†

è¿™é‡Œæœ‰ä¸€ä¸ªä¾‹å­ä½ ç»™è§£é‡Šä¸€ä¸‹ï¼Œä¸ºä»€ä¹ˆ header çš„ dom æ— éœ€é‡æ–°è·å–?

![image-20220519150756550](https://raw.githubusercontent.com/chihokyo/image_host/develop/image-20220519150756550.png)

ä¸‹é¢ç›´æ¥å†™å‡ ä¸ªé—­åŒ…å§ã€‚

å…¶å®ä¸‹é¢è¿™å°±æ˜¯ä¸€ä¸ªå‡½æ•°æŸ¯é‡ŒåŒ–ï¼Œä½†ä¹Ÿä¼šäº§ç”Ÿé—­åŒ…ã€‚å‡½æ•°æŸ¯é‡ŒåŒ–å¿…ç„¶äº§ç”Ÿé—­åŒ…ï¼ï¼

![image-20220519231357886](https://raw.githubusercontent.com/chihokyo/image_host/develop/image-20220519231357886.png)

å…¶å®å‚æ•°ä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªå‡½æ•°çš„ã€‚

![image-20220519232208136](https://raw.githubusercontent.com/chihokyo/image_host/develop/image-20220519232208136.png)

![image-20230210004809477](https://raw.githubusercontent.com/chihokyo/image_host/develop/image-20230210004809477.png)

é‚£ä¹ˆé—­åŒ…åœ¨å†…å­˜ä¸­æ˜¯å¦‚ä½•è¡¨ç°çš„å‘¢ï¼Ÿ

### 3-2 é—­åŒ…å†…å­˜æ‰§è¡Œé¡ºåº

```javascript
function foo() {
  var id = 100;
  return function bar() {
    console.log(id);
  };
}

var newBar = foo(); // â† ä¸‹é¢çš„å›¾åˆ°è¿™é‡Œæˆªæ­¢
newBar();
```

![image-20220520001419295](https://raw.githubusercontent.com/chihokyo/image_host/develop/image-20220520001419295.png)

æ¥ä¸‹æ¥å†çœ‹æœ€åä¸€è¡Œä»£ç çš„æ‰§è¡Œï¼Œå‘ç°æ˜¯è¿è¡Œäº†`newBar()`

```javascript
function foo() {
  var id = 100;
  return function bar() {
    console.log(id);
  };
}

var newBar = foo();
newBar(); // â† å¼€å§‹æ‰§è¡Œè¿™é‡Œ
```

ä¸‹é¢è¿™å¹…å›¾æ˜¯`newBar()`ä¹‹åçš„æ‰§è¡Œæƒ…å†µ

ä¸‹é¢çš„å›¾ç‰‡å®Œå…¨å°±å¯ä»¥è§£é‡Šåˆ°ï¼Œä¸ºä»€ä¹ˆ`foo()`æ‰§è¡Œå®Œäº†ä¹‹å`newBar()`è¿˜èƒ½ä¿å­˜å˜é‡ï¼Œ

å› ä¸ºå…¨å±€çš„ GO é‡Œé¢ä¸€ç›´æœ‰ä½œç”¨åŸŸå¼•ç”¨æŒ‡å‘äº†è¿™ä¸ª AO å¯¹è±¡ï¼Œæ‰€ä»¥å®ƒä¸ä¼šè¢«é‡Šæ”¾æ‰ã€‚

![image-20220520002908688](https://raw.githubusercontent.com/chihokyo/image_host/develop/image-20220520002908688.png)

åœ¨è¿™é‡Œè¡¥å……ä¸€äº›å°é—®é¢˜ã€‚å‡½æ•°åµŒå¥—å°±ä¸€å®šæœ‰é—­åŒ…å—ï¼Ÿ

> å‡½æ•°åµŒå¥—ä¸ä¸€å®šï¼Œå•çº¯çš„å‡½æ•°è°ƒç”¨å°±ä¸æ˜¯ã€‚

```javascript
// è¿™é‡Œå¯ä»¥å¾ˆæ˜æ˜¾çš„çœ‹åˆ°ç¡®å®æ˜¯ã€å‡½æ•°åµŒå¥—ã€‘
// ä½†æ˜¯ä½ æ‰§è¡Œä¹‹åèƒ½æ‹¿åˆ°nå—ï¼Ÿ
// å¦‚æœæŒ‰ç…§å‡½æ•°åµŒå¥—å°±ä¼šäº§ç”Ÿé—­åŒ…çš„ç†è®º n å°±èƒ½æ‹¿åˆ°
function foo(fn) {
  var n = 0;
  fn(); // è¿™é‡Œåªæ˜¯è°ƒç”¨ï¼Œfnè¿™ä¸ªå‡½æ•°çš„è¯ç”Ÿå¹¶éæ˜¯å› ä¸ºfooçš„æ‰§è¡Œï¼ï¼
}

function bar() {
  console.log(n);
}

foo(bar); // æŠ¥é”™ ReferenceError: n is not defined
```

### 3-3 ä¸€äº›é—­åŒ…çš„æ¡ˆä¾‹

ä½¿ç”¨`done`è¿™ä¸ªå˜é‡æ¥å®ç°è®°å½•ä¸€ä¸‹å‡½æ•°æœ‰æ²¡æœ‰è¢«å¤šæ¬¡æ‰§è¡Œã€‚

```javascript
// ä¸€æ®µä»£ç åªèƒ½æ‰§è¡Œä¸€æ¬¡
function once(fn) {
  let done = false;
  return function () {
    if (!done) {
      done = true;
      return fn.apply(this, arguments);
    }
  };
}
let pay = once(function (money) {
  console.log(`${money} RMB`);
});

pay(2);
pay(3); // è¿™ä¸€æ¬¡ä¸ä¼šè¢«æ‰§è¡Œ
```

### 3-4 é—­åŒ…ç»å¸¸å’Œç«‹å³æ‰§è¡Œå‡½æ•°ä¸€èµ·æ¥ææ’ä»¶

ä¸ºä»€ä¹ˆå‘¢ï¼Œå› ä¸ºä»¥å‰æ˜¯æ²¡æœ‰å—çº§ä½œç”¨åŸŸã€‚åªæœ‰å‡½æ•°ä½œç”¨åŸŸï¼Œéƒ½å†™åœ¨ç«‹å³å‡½æ•°é‡Œé¢å¯ä»¥ä¿è¯**ä¸ä¼šæ±¡æŸ“å…¨å±€å˜é‡**

æ€ä¹ˆæå‘¢ï¼Ÿ

```js
(function () {
  var a = 10;
  var b = 20;

  function add(num1, num2) {
    var num1 = !!num1 ? num1 : a;
    var num2 = !!num2 ? num2 : b;

    return num1 + num2;
  }
  // è¿™é‡Œç›¸å½“äºå°±æš´éœ²å‡ºå»äº†
  window.add = add;
})();

add(10, 20);
```

é¡ºä¾¿æ€è€ƒä¸‹ä»¥ä¸‹ä¸¤ç§ä»£ç çš„åŒºåˆ«

```js
(function () {
  var a = 10;
  var b = 20;

  function add(num1, num2) {
    var num1 = !!num1 ? num1 : a;
    var num2 = !!num2 ? num2 : b;

    return num1 + num2;
  }
  // é‡ç‚¹åœ¨è¿™é‡Œ
  window.add = add;
})(window);

(function () {
  var a = 10;
  var b = 20;

  function add(num1, num2) {
    var num1 = !!num1 ? num1 : a;
    var num2 = !!num2 ? num2 : b;

    return num1 + num2;
  }

  window.add = add;
})();
```

> **ä¸¤æ®µä»£ç çš„ä¸»è¦åŒºåˆ«åœ¨äºå®ƒä»¬çš„æ‰§è¡Œä¸Šä¸‹æ–‡ï¼**åœ¨ç¬¬äºŒæ®µä»£ç ä¸­å¹¶æ²¡æœ‰ä¼ å…¥æ‰§è¡Œä¸Šä¸‹æ–‡å‚æ•°ï¼Œå› æ­¤é»˜è®¤ä½¿ç”¨äº†å½“å‰æ‰§è¡Œä¸Šä¸‹æ–‡ã€‚
>
> æ€»ä½“çš„è¯å°±æ˜¯è¯´ã€‚
>
> - æ‰§è¡Œæ•ˆç‡å¿«
> - æŠŠ window å¯¹è±¡å˜æˆè‡ªæ‰§è¡Œå‡½æ•°çš„å±€éƒ¨ä½œç”¨åŸŸå°±ä¸å¾€ä¸Šå±‚æ‰¾äº†

ä¸‹é¢æ˜¯ openai å†™çš„ç­”æ¡ˆ

> JavaScript é—­åŒ…æœ‰è®¸å¤šå®é™…çš„ä½¿ç”¨åœºæ™¯ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›ç¤ºä¾‹ï¼š
>
> 1. å°è£…ç§æœ‰å˜é‡å’Œå‡½æ•°ï¼šæ‚¨å¯ä»¥ä½¿ç”¨é—­åŒ…æ¥å°è£…ç§æœ‰å˜é‡å’Œå‡½æ•°ï¼Œå¹¶éšè—å®ƒä»¬ä¸å¯¹å¤–éƒ¨å¯è§ã€‚ ğŸ‘‰ğŸ» private åŠŸèƒ½
> 2. æ¨¡å—åŒ–ç¼–ç¨‹ï¼šæ‚¨å¯ä»¥ä½¿ç”¨é—­åŒ…æ¥åˆ›å»ºç‹¬ç«‹çš„æ¨¡å—ï¼Œå…è®¸æ‚¨ä¿æŠ¤å…¨å±€å‘½åç©ºé—´å¹¶é¿å…å‘½åå†²çªã€‚ğŸ‘‰ğŸ» æ¨¡å—åŒ–
> 3. è®°å½•å˜é‡çŠ¶æ€ï¼šæ‚¨å¯ä»¥ä½¿ç”¨é—­åŒ…æ¥è®°å½•å˜é‡çš„çŠ¶æ€ï¼Œå¹¶åœ¨ä¹‹åä½¿ç”¨è¯¥çŠ¶æ€ã€‚è¿™æ˜¯é€šè¿‡é—­åŒ…åœ¨å†…å­˜ä¸­å­˜å‚¨å˜é‡çš„æ–¹å¼å®ç°çš„ã€‚ğŸ‘‰ğŸ» ä½œç¼“å­˜
> 4. å®ç°å»¶è¿ŸåŠ è½½ï¼šæ‚¨å¯ä»¥ä½¿ç”¨é—­åŒ…æ¥å®ç°å»¶è¿ŸåŠ è½½ï¼Œå¹¶åœ¨éœ€è¦æ—¶åˆ›å»ºå‡½æ•°ã€‚
> 5. åˆ›å»ºç®€å•çš„è®¡æ•°å™¨ï¼šæ‚¨å¯ä»¥ä½¿ç”¨é—­åŒ…æ¥åˆ›å»ºç®€å•çš„è®¡æ•°å™¨ï¼Œå¹¶åœ¨æ¯æ¬¡è°ƒç”¨æ—¶å¢åŠ è®¡æ•°ã€‚

### 3-5 é—­åŒ…å’ŒæŸ¯é‡ŒåŒ–ä¹Ÿæœ‰æ¸Šæº

å› ä¸ºæŸ¯é‡ŒåŒ–åˆ©ç”¨çš„å°±æ˜¯é—­åŒ…ï¼Œæ‰èƒ½æ‹¿åˆ°ä¸Šä¸€ä¸ªå‡½æ•°çš„ç»“æœã€‚

```javascript
// æ²¡â†’æŸ¯é‡ŒåŒ–
function foo(m, n, x, y) {
  return m + n + x + y;
}
console.log(foo(1, 2, 3, 4));

// æœ‰â†’æŸ¯é‡ŒåŒ–
// å…¶å®è¿™é‡Œä¹Ÿæœ‰é—­åŒ…ï¼Œå¯ä»¥ä½¿ç”¨å¤–é¢çš„å‚æ•°æ•°æ®
function foo1(m) {
  return function foo2(n) {
    return function foo3(x) {
      return function foo4(y) {
        return m + n + x + y;
      };
    };
  };
}
console.log(foo1(1)(2)(3)(4));

// ç®­å¤´å‡½æ•°
var foo = (m) => {
  // âš ï¸ è¿™é‡Œå°±æ˜¯é—­åŒ… âš ï¸
  // mèƒ½åœ¨nçš„åœ°æ–¹è¢«æ‹¿åˆ°ã€‚å¹¶ä¸”ä¸€ç›´åˆ°æœ€åã€‚
  return (n) => {
    return (x) => {
      return (y) => {
        return m + n + x + y;
      };
    };
  };
};
console.log(foo(2)(3)(3)(4));

// ç®­å¤´å‡½æ•°è¿›ä¸€æ­¥ç®€åŒ–
var fooMini = (m) => (n) => (x) => (y) => {
  return m + n + x + y;
};
console.log(fooMini(1)(2)(3)(4));
```

ä¸‹é¢ä¹Ÿæ˜¯ä¸€ä¸ªæŸ¯é‡ŒåŒ–

```js
function add() {
  //å°†ä¼ å…¥çš„ä¸å®šå‚æ•°è½¬ä¸ºæ•°ç»„å¯¹è±¡
  let _args = Array.prototype.slice.call(arguments);
  let _adder = function () {
    _args.push(...arguments);
    return _adder;
  };

  _adder.toString = function () {
    return _args.reduce(function (a, b) {
      return a + b;
    }, 0);
  };

  return _adder;
}
let a = add(1, 2, 3);
let b = add(1)(2)(4, 3);
console.log(a); // 6
console.log(b); // 10
```

å¯èƒ½åˆšå¼€å§‹çœ‹æœ‰äº›è¿·ç³Šï¼Œæ•´ç†é¡ºåºå¦‚ä¸‹ã€‚

![image-20230210141003432](https://raw.githubusercontent.com/chihokyo/image_host/develop/image-20230210141003432.png)

è¿™é‡Œéš¾ç‚¹æœ‰ 2 ä¸ªï¼Œä¸€ç›´æ˜¯ args çš„å˜åŒ–ã€‚ä¸€ä¸ªæ˜¯ return ä¸ºä»€ä¹ˆæœ€åæœ‰ä¸¤ä¸ªã€‚

![image-20230210142303788](https://raw.githubusercontent.com/chihokyo/image_host/develop/image-20230210142303788.png)

### 3-6 é—­åŒ…+ç«‹å³å‡½æ•° ç›¸å½“äº OOP é‡Œçš„ private ç”¨æ³•

æ¯”å¦‚ä¸‹é¢

```js
// åˆ›å»ºä¸€ä¸ªç«‹å³æ‰§è¡Œçš„åŒ¿åå‡½æ•°
// è¯¥å‡½æ•°ç«‹å³ä¹‹åè¿”å›ä¸€ä¸ªå¯¹è±¡ï¼ŒreturnåŒ…å«ä½ è¦æš´éœ²çš„å±æ€§
// å¦‚ä¸‹ä»£ç å¦‚æœä¸ä½¿ç”¨ç«‹å³æ‰§è¡Œå‡½æ•°ï¼Œå°±ä¼šå¤šä¸€ä¸ªå±æ€§i
// å¦‚æœæœ‰äº†å±æ€§iï¼Œæˆ‘ä»¬å°±èƒ½è°ƒç”¨counter.iæ”¹å˜içš„å€¼
// â†‘ è¿™é‡Œåˆ©ç”¨äº†ä¸€å®šçš„é—­åŒ…
// å¯¹æˆ‘ä»¬æ¥è¯´è¿™ç§ä¸ç¡®å®šçš„å› ç´ è¶Šå°‘è¶Šå¥½

var counter = (function () {
  var i = 0;
  return {
    get: function () {
      return i;
    },
    set: function (val) {
      i = val;
    },
    increment: function () {
      return ++i;
    },
  };
})();

// counterå…¶å®æ˜¯ä¸€ä¸ªå¯¹è±¡

counter.get();
counter.set(3);
counter.increment();
counter.increment();

counter.i; // undefined iå¹¶ä¸æ˜¯counterçš„å±æ€§
i; // ReferenceError: i is not defined (å‡½æ•°å†…éƒ¨çš„æ˜¯å±€éƒ¨å˜é‡)
```

```js
// ä¸Šé¢é‚£ä¸ªææ’ä»¶çš„å…¶å®å†™çš„å·®ä¸å¤šäº†
(function () {
  let count = 0;
  function increment() {
    count += 1;
    return count;
  }
  window.counter = {
    increment: increment,
  };
})();

console.log(counter.increment()); // 1
console.log(counter.increment()); // 2

// æˆ–è€…ä½ å¯ä»¥è¿™æ ·å†™
const counter = (function () {
  let count = 0;
  function increment() {
    count += 1;
    return count;
  }
  return { increment };
})();

console.log(counter.increment()); // 1
console.log(counter.increment()); // 2
```

## 4 ä»€ä¹ˆæ˜¯é—­åŒ…çš„å†…å­˜æ³„æ¼ï¼Ÿ

å…¶å®å°±æ˜¯**é—­åŒ…å‡½æ•°åœ°å€**å’Œ**å‘¨å›´ç¯å¢ƒçš„é‚£ä¸ªå‡½æ•°åœ°å€**äº’ç›¸æŒ‡å‘å¯¹æ–¹ï¼Œå¯¼è‡´è¿Ÿè¿Ÿä¸ä¼šè¢«é”€æ¯ï¼

æ­¤æ—¶éœ€è¦ä¸€å¼ å›¾ã€‚

JavaScript é—­åŒ…çš„å†…å­˜æ³„æ¼æŒ‡çš„æ˜¯é—­åŒ…å¼•ç”¨çš„å¤–éƒ¨å˜é‡ä¸èƒ½æ­£å¸¸é‡Šæ”¾ï¼Œé€ æˆäº†å†…å­˜çš„æµªè´¹ã€‚

**1 å½“ä¸€ä¸ªé—­åŒ…å¼•ç”¨äº†å¤–éƒ¨å˜é‡ï¼Œå³ä½¿è¯¥é—­åŒ…å·²ç»ä¸å†éœ€è¦ä½¿ç”¨å¤–éƒ¨å˜é‡ï¼Œ2 å¤–éƒ¨å˜é‡ä»ç„¶ä¸èƒ½è¢«é‡Šæ”¾ï¼Œå› ä¸ºé—­åŒ…ä»ç„¶å¯¹å®ƒä»¬æŒæœ‰å¼•ç”¨ã€‚**è¿™å°±æ˜¯é—­åŒ…å†…å­˜æ³„æ¼çš„æ ¹æœ¬åŸå› ã€‚

ä¾‹å¦‚ï¼Œä¸‹é¢æ˜¯ä¸€ä¸ªæ¨¡æ‹Ÿå†…å­˜æ³„æ¼çš„ä»£ç ç¤ºä¾‹ï¼š

```js
function makeAdder() {
  var i = 0;
  return function () {
    i += 1;
    return i;
  };
}

var adder = makeAdder();
adder(); // 1
adder(); // 2
```

åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œ`makeAdder` å‡½æ•°è¿”å›äº†ä¸€ä¸ªåŒ¿åå‡½æ•°ï¼Œè¯¥åŒ¿åå‡½æ•°å¼•ç”¨äº†å¤–éƒ¨å˜é‡ `i`ã€‚å³ä½¿æˆ‘ä»¬ä¸å†éœ€è¦ä½¿ç”¨è¯¥åŒ¿åå‡½æ•°ï¼Œå®ƒä»ç„¶ä¸ä¼šè¢«é‡Šæ”¾ï¼Œå› ä¸ºæˆ‘ä»¬ä¿å­˜äº†å¯¹å®ƒçš„å¼•ç”¨ã€‚

å¦‚ä½•é¿å…å†…å­˜æ³„æ¼å‘¢ï¼Ÿ

1. ä½¿ç”¨åƒåœ¾å›æ”¶æœºåˆ¶ï¼šåœ¨ JavaScript ä¸­ï¼Œåƒåœ¾å›æ”¶æœºåˆ¶å¯ä»¥è‡ªåŠ¨é‡Šæ”¾ä¸å†éœ€è¦çš„å˜é‡å’Œå¯¹è±¡çš„å†…å­˜ã€‚
2. æ˜¾å¼åœ°é‡Šæ”¾å†…å­˜ï¼šé€šè¿‡æ‰‹åŠ¨å°†ä¸å†éœ€è¦çš„å˜é‡å’Œå¯¹è±¡çš„å¼•ç”¨è®¾ç½®ä¸º `null`ï¼Œå¯ä»¥å¼ºåˆ¶è§¦å‘åƒåœ¾å›æ”¶æœºåˆ¶é‡Šæ”¾å†…å­˜ã€‚
3. ä½¿ç”¨ç«‹å³æ‰§è¡Œå‡½æ•°ï¼šé€šè¿‡åœ¨åŒ¿åå‡½æ•°çš„ä½œç”¨åŸŸä¸­å¼•å…¥å±€éƒ¨å˜é‡ï¼Œå¯ä»¥é¿å…æŒæœ‰å¤–éƒ¨å˜é‡çš„å¼•ç”¨ã€‚

```javascript
function makeAdder() {
  return (function () {
    var i = 0;
    return function () {
      i += 1;
      return i;
    };
  })();
}

var adder = makeAdder();
adder(); // 1
adder(); // 2
adder = null; // æ‰‹åŠ¨é‡Šæ”¾å†…å­˜
```
