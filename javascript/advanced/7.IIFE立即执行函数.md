# IIFE

_IIFE_(Immediately Invoked Functions Expressions)

ç«‹å³æ‰§è¡Œå‡½æ•°ï¼Œå¤šå’Œé—­åŒ…ä¸€èµ·ä½¿ç”¨ã€‚æ‰€ä»¥**é—­åŒ…**ä½ ä¹Ÿè¦æ‡‚ã€‚ğŸ‘ğŸ» è¦æ±‚å¿…é¡»é…åˆé—­åŒ…ä¸€èµ·é£Ÿç”¨ï¼

## 1 why

æ—¢ç„¶æœ‰äº†æ™®é€šå‡½æ•°ï¼Œä¸ºä»€ä¹ˆè¦ç”¨ç«‹å³æ‰§è¡Œå‡½æ•°å‘¢ï¼Ÿ

javascript ä¸­æ²¡ç”¨ç§æœ‰ä½œç”¨åŸŸçš„æ¦‚å¿µï¼ˆjava é‡Œçš„ private é‚£ç§ï¼Œå¤–éƒ¨ä¸èƒ½ç›´æ¥.ï¼‰ã€‚å¦‚æœåœ¨å¤šäººå¼€å‘çš„é¡¹ç›®ä¸Šï¼Œä½ åœ¨å…¨å±€æˆ–å±€éƒ¨ä½œç”¨åŸŸä¸­å£°æ˜äº†ä¸€äº›å˜é‡ï¼Œå¯èƒ½ä¼šè¢«å…¶ä»–äººä¸å°å¿ƒç”¨åŒåçš„å˜é‡ç»™è¦†ç›–æ‰ã€‚

![image-20220519202001259](https://raw.githubusercontent.com/chihokyo/image_host/develop/image-20220519202001259.png)

æ ¹æ® javascript å‡½æ•°ä½œç”¨åŸŸé“¾çš„ç‰¹æ€§ï¼Œå¯ä»¥ä½¿ç”¨è¿™ç§æŠ€æœ¯å¯ä»¥æ¨¡ä»¿ä¸€ä¸ªç§æœ‰ä½œç”¨åŸŸï¼Œç”¨åŒ¿åå‡½æ•°ä½œä¸ºä¸€ä¸ªã€Œå®¹å™¨ã€ï¼Œã€Œå®¹å™¨ã€å†…éƒ¨å¯ä»¥è®¿é—®å¤–éƒ¨çš„å˜é‡ï¼Œè€Œå¤–éƒ¨ç¯å¢ƒä¸èƒ½è®¿é—®ã€Œå®¹å™¨ã€å†…éƒ¨çš„å˜é‡ï¼Œæ‰€ä»¥`( function(){â€¦} )()`å†…éƒ¨å®šä¹‰çš„å˜é‡ä¸ä¼šå’Œå¤–éƒ¨çš„å˜é‡å‘ç”Ÿå†²çªï¼Œä¿—ç§°ã€ŒåŒ¿ååŒ…è£¹å™¨ã€æˆ–ã€Œå‘½åç©ºé—´ã€ã€‚**å…¶å® TS çš„å‘½åç©ºé—´å°±æ˜¯è¿ç”¨äº† JS çš„é—­åŒ…ã€‚**

> jQuery ä½¿ç”¨çš„å°±æ˜¯è¿™ç§æ–¹æ³•ï¼Œå°† jQuery ä»£ç åŒ…è£¹åœ¨`( function (window,undefined){â€¦jqueryä»£ç â€¦} (window)`ä¸­ï¼Œåœ¨å…¨å±€ä½œç”¨åŸŸä¸­è°ƒç”¨ jQuery ä»£ç æ—¶ï¼Œå¯ä»¥è¾¾åˆ°ä¿æŠ¤ jQuery å†…éƒ¨å˜é‡çš„ä½œç”¨ã€‚

è¿™æ˜¯å› ä¸ºå†å²çš„ä½œç”¨åŸŸé—®é¢˜ã€‚js åœ¨ es5 ä¹‹å‰æ˜¯æ²¡æœ‰å—çº§ä½œç”¨åŸŸçš„ï¼Œ**åªæœ‰å‡½æ•°ä½œç”¨åŸŸå’Œå…¨å±€ä½œç”¨åŸŸ**ã€‚åœ¨ for/if è¿™ç§è¯­å¥é‡Œå°±ä¼šäº§ç”Ÿæ±¡æŸ“å…¨å±€ä½œç”¨åŸŸçš„é—®é¢˜ã€‚

```js
var id = 1;
for (var id = 0; id < 10; id++) {}
console.log(id); // 10
// æ˜æ˜åœ¨å¤–éƒ¨å®šä¹‰çš„idï¼Œå´è¢«foré‡Œé¢ç»™æ›´æ”¹äº†ã€‚
```

ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå°±å‡ºæ¥äº† IIFEã€‚ç›´æ¥åŒ…è£¹èµ·æ¥ï¼Œå½¢æˆå‡½æ•°ä½œç”¨åŸŸã€‚

```js
(function () {
  var id = 99;
})();

console.log(id); // ReferenceError: id is not defined
```

## 2 åŸºæœ¬æƒ…å†µ

ç«‹å³æ‰§è¡Œå‡½æ•°å’Œæ™®é€šå‡½æ•°ä¸€æ ·ï¼Œä¹Ÿå¯ä»¥æ¥å—å‚æ•°ï¼Œä¸€æ ·ä¹Ÿæœ‰è¿”å›å€¼ã€‚

```js
// 1ï¸âƒ£ ä¸€æ ·å¯ä»¥æ¥å—å‚æ•°
(function (id) {
  // å½¢å‚ï¼šid
  console.log(id); // 2
})(2); // å®å‚ï¼š2

// 2ï¸âƒ£ ä¸€æ ·å¯ä»¥æœ‰è¿”å›å€¼
var res = (function (id) {
  console.log(id); // 2
  return 'IIFE';
})(2);
console.log(res); // IIFE
```

## 3 è°ƒç”¨æœºåˆ¶

åœ¨ JS é‡Œçš„ç«‹å³æ‰§è¡Œå‡½æ•°ä¼šæœ‰ä»¥ä¸‹å‡ ç§è°ƒç”¨æ–¹å¼ã€‚ä½†æ˜¯ä»”ç»†çœ‹ï¼Œè¿™é‡Œ**è°ƒç”¨çš„æœºåˆ¶**éƒ½æ˜¯ä¸ä¸€æ ·çš„ã€‚

```javascript
// ç”±äºvscodeè‡ªåŠ¨ç»™æˆ‘æ ¼å¼åŒ–äº†ã€‚æ‰€ä»¥çœ‹èµ·æ¥å‡ ä¹æ˜¯ä¸€æ ·çš„ã€‚

// 1ï¸âƒ£ è¿™é‡Œå…¶å®å°±æ˜¯å°æ‹¬å·æŠŠå‡½æ•°å½“æ•´ä½“ + å‡½æ•°è°ƒç”¨ç»„åˆ
(function sum(a, b) {
  console.log(a + b);
})(1, 2);

// 2ï¸âƒ£ å½“å‡ºç°()çš„æ—¶å€™é‡Œé¢ä¼šè¢«å¼ºåˆ¶æ±‚å€¼ï¼Œå°±è§¦å‘äº†å‡½æ•°è°ƒç”¨
(function sum(a, b) {
  console.log(a + b);
})(1, 2);

// 3ï¸âƒ£è¿™é‡Œè¦å¿…é¡»åŠ ä¸Šè¿ç®—ç¬¦ï¼Œè™½ç„¶+-/* voidéƒ½å¯ä»¥
// ä¸€å…ƒè¿ç®—ç¬¦å¯ä»¥å¼ºåˆ¶å‡½æ•°æ‰§è¡Œ
+(function sum(a, b) {
  console.log(a + b);
})(1, 2);
```

![image-20220531173629137](https://raw.githubusercontent.com/chihokyo/image_host/develop/image-20220531173629137.png)

## 4 å®é™…è¿ç”¨

### 4-1 é˜²æ­¢å¤šä¸ªæ¨¡å—å…¨å±€å˜é‡å‘½åå†²çªï¼ˆæ¨¡å—åŒ–ï¼‰

è¿™é‡Œçš„æ¨¡å—å¯ä»¥ç®€å•ç†è§£æˆä¸åŒçš„ js

ä½¿ç”¨å‰

```js
// a.js
var id = 1;
// b.js
var id = 9;
// main.js
console.log(id); // æ ¹æ®å¯¼å…¥çš„å‰åé¡ºåºæ‰“å°å‡ºæ¥çš„å°±æ˜¯9
```

> è¿™æ ·å¾ˆä¸å¥½ï¼Œä¼šéšä¾¿è¦†ç›–åˆ«äººå†™çš„ä»£ç ã€‚

ä½¿ç”¨å

```js
/****a.js******/
// 4 ç”¨å˜é‡æ¥æ”¶
var aModul = (function () {
  // 1 å…ˆå†™ä¸€ä¸ªå¯¹è±¡
  var aModul = {};
  var id = 1;
  // 2 èµ‹å€¼ç»™è¿™ä¸ªå¯¹è±¡
  aModul.id = id;
  // 3 ç›´æ¥æš´éœ²å‡ºå»
  return aModul;
})();

/****b.js******/
// 4 ç”¨å˜é‡æ¥æ”¶
var bModul = (function () {
  // 1 å…ˆå†™ä¸€ä¸ªå¯¹è±¡
  var bModul = {};
  var id = 9;
  // 2 èµ‹å€¼ç»™è¿™ä¸ªå¯¹è±¡
  bModul.id = id;
  // 3 ç›´æ¥æš´éœ²å‡ºå»
  return bModul;
})();

/****main.js******/
// æƒ³ç”¨è°çš„å°±æ‰“å°è°çš„
console.log(aModul.id); // 1
console.log(bModul.id); // 9
```

### 4-2 DOM å¯¹è±¡æ“ä½œé—®é¢˜

æœ‰ä¸€ä¸ªç»å…¸çš„ dom æ“ä½œé—®é¢˜ã€‚

å°±æ˜¯ç‚¹å‡»å“ªä¸ª liï¼Œå“ªä¸ªé«˜äº®ã€‚

```html
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>IIFE</title>
  </head>
  <body>
    <ul>
      <li>1</li>
      <li>2</li>
      <li>3</li>
      <li>4</li>
      <li>5</li>
    </ul>
  </body>
  <script>
    var liEls = document.querySelectorAll('li');
    for (var i = 0; i < liEls.length; i++) {
      liEls[i].onclick = function () {
        console.log(`ç¬¬${i}ä¸ªè¢«onclickäº†`);
      };
    }
    /* è¿™é‡Œå°†æ°¸è¿œéƒ½ä¼šæ˜¯5ç¬¬5ä¸ªè¢«onclickäº†
     * ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ
     * å› ä¸ºåœ¨ä»£ç æ‰§è¡Œonclickäº‹ä»¶ï¼Œä¹Ÿå°±æ˜¯åœ¨ä½ ç‚¹å‡»ä¹‹å‰forçš„ä»£ç å—å·²ç»æ‰§è¡Œå®Œæ¯•äº†
     * è€Œä¸”åˆç”±äºvaræ²¡æœ‰å—çº§ä½œç”¨åŸŸï¼Œæ˜¯å…¨å±€çš„ï¼Œæ­¤æ—¶çš„iå·²ç»æ˜¯5äº†ã€‚
     * é‚£ä¹ˆæ— è®ºæ€ä¹ˆç‚¹å‡»éƒ½å°†ä¼šæ˜¯5ï¼
     */

    // ä¿®æ”¹æ–¹æ¡ˆ1ï¸âƒ£ varæ”¹æˆlet
    var liEls = document.querySelectorAll('li');
    for (let i = 0; i < liEls.length; i++) {
      liEls[i].onclick = function () {
        console.log(`ç¬¬${i}ä¸ªè¢«onclickäº†`);
      };
    }
    // ä¿®æ”¹æ–¹æ¡ˆ2ï¸âƒ£ IIFEä¿è¯å‡½æ•°ä½œç”¨åŸŸ
    var liEls = document.querySelectorAll('li');
    for (var i = 0; i < liEls.length; i++) {
      (function (m) {
        // mä½œä¸ºå®å‚ï¼Œå®é™…ä¼ å…¥çš„iå°±ä¿å­˜ä¸‹æ¥äº†
        liEls[i].onclick = function () {
          console.log(`ç¬¬${m}ä¸ªè¢«onclickäº†`);
        };
      })(i); // è¿™é‡Œä¼ å…¥çš„iå°±æ˜¯æ¯ä¸€æ¬¡forç©¿è¿›å»çš„i
    }
  </script>
</html>
```

### 4-3 å†™æ’ä»¶

IIFE å’Œé—­åŒ…åˆä½œå¯ä»¥å†™æ’ä»¶çš„é—®é¢˜

```javascript
// åˆ›å»ºä¸€ä¸ªç«‹å³æ‰§è¡Œçš„åŒ¿åå‡½æ•°
// è¯¥å‡½æ•°ç«‹å³ä¹‹åè¿”å›ä¸€ä¸ªå¯¹è±¡ï¼ŒreturnåŒ…å«ä½ è¦æš´éœ²çš„å±æ€§
// å¦‚ä¸‹ä»£ç å¦‚æœä¸ä½¿ç”¨ç«‹å³æ‰§è¡Œå‡½æ•°ï¼Œå°±ä¼šå¤šä¸€ä¸ªå±æ€§i
// å¦‚æœæœ‰äº†å±æ€§iï¼Œæˆ‘ä»¬å°±èƒ½è°ƒç”¨counter.iæ”¹å˜içš„å€¼
// â†‘ è¿™é‡Œåˆ©ç”¨äº†ä¸€å®šçš„é—­åŒ…
// å¯¹æˆ‘ä»¬æ¥è¯´è¿™ç§ä¸ç¡®å®šçš„å› ç´ è¶Šå°‘è¶Šå¥½

var counter = (function () {
  var i = 0;
  return {
    get: function () {
      return i;
    },
    set: function (val) {
      i = val;
    },
    increment: function () {
      return ++i;
    },
  };
})();

// counterå…¶å®æ˜¯ä¸€ä¸ªå¯¹è±¡

counter.get();
counter.set(3);
counter.increment();
counter.increment();

counter.i; // undefined iå¹¶ä¸æ˜¯counterçš„å±æ€§
i; // ReferenceError: i is not defined (å‡½æ•°å†…éƒ¨çš„æ˜¯å±€éƒ¨å˜é‡)
```

[](https://blog.pig1024.me/posts/595de32081c3e54eac7a6ddb)

## 5 ä¸€äº›ç»†èŠ‚é—®é¢˜

### (function(){}()) å’Œ ï¼ˆfunction(){}ï¼‰() çš„åŒºåˆ«

```js
(function () {})()(
  //ç›´æ¥æ‰§è¡ŒåŒ¿åå‡½æ•°ï¼Œæ— æ³•ä¼ å‚

  function () {}
)(); //å…ˆå®šä¹‰åŒ¿åå‡½æ•°å†è°ƒç”¨æ‰§è¡Œï¼Œå¯ä¼ å…¥å‚æ•°
```

`(function(){})();` æ˜¯ æŠŠå‡½æ•°å½“ä½œè¡¨è¾¾å¼è§£æï¼Œç„¶åæ‰§è¡Œè§£æåçš„å‡½æ•°

ç›¸å½“äº `var a = function(){}; a();` a å¾—åˆ°çš„æ˜¯å‡½æ•°

`(function(){}()); `æ˜¯æŠŠå‡½æ•°è¡¨è¾¾å¼å’Œæ‰§è¡Œå½“ä½œè¯­å¥ç›´æ¥æ‰§è¡Œã€

ç›¸å½“äº `var a = function(){}();` a å¾—åˆ°çš„æ˜¯ç»“æœæœ€ç»ˆç»“æœæ˜¯ä¸€æ ·çš„ã€()åªæ˜¯èµ·äº†è‡ªæ‰§è¡Œçš„ä½œç”¨.
