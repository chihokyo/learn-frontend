# webpack

## ç»¼è¿°

webpack æ˜¯å•¥å­å‘¢ï¼Ÿæˆ‘ç®€å•çš„è¯´ä¸€ä¸‹å§ã€‚å…¶å®å°±æ˜¯æ¨¡å—åŒ–å·¥ç¨‹åŒ–å¿…å¤‡çš„**æ‰“åŒ…å·¥å…·**ï¼

æ— è®ºä½ å†™äº†ä»€ä¹ˆä¸œè¥¿ï¼Œé€šè¿‡ webpack éƒ½å¯ä»¥ç»™ä½ ä¸€è‚¡è„‘ææˆ html/css/js ä¸‰å‰‘å®¢é™æ€èµ„æºï¼å®˜ç½‘çš„è¿™ä¸ªå›¾å…¶å®ç‰¹åˆ«å½¢è±¡ï¼ä¸­é—´é‚£ä¸ªæ ¸å¿ƒå°±æ˜¯ webpackï¼

![Webpack - A Detailed Introduction â€” Smashing Magazine](https://cloud.netlifyusercontent.com/assets/344dbf88-fdf9-42bb-adb4-46f01eedd629/e4c48715-874f-447a-a915-c4615f7f1123/webpack-js-opt.png)

## å°è¯•ç‰›åˆ€

- **å®‰è£…**

å»ºè®®æœ¬åœ°å®‰è£…ï¼Œä¸è¦å…¨å±€å®‰è£…ã€‚å› ä¸ºæ¯ä¸ªé¡¹ç›®è¦æ±‚çš„ webpack ç‰ˆæœ¬å¯èƒ½ä¸ä¸€æ ·ã€‚è€Œä¸” webpack4 ä¹‹åéƒ½è¦ä¾èµ– webpack-cli è¿™ä¸ªå‘½ä»¤è¡Œå·¥å…·äº†ã€‚

```js
npm install webpack webpack-cli -D
```

- **ç›´æ¥è¾“å‡º æ–‡ä»¶å¤¹æ„æˆ**

```js
.
â”œâ”€â”€ dist  //è¾“å‡ºå¿…é¡»æ˜¯ dist/main.js
â”‚Â Â  â””â”€â”€ main.js
â”œâ”€â”€ package-lock.json
â”œâ”€â”€ package.json
â””â”€â”€ src
    â””â”€â”€ index.js //è¾“å…¥å¿…é¡»æ˜¯src/index.js
```

input é»˜è®¤è¾“å…¥ `src/index.js` ,output é»˜è®¤è¾“å‡º` dist/main.js`

ç›´æ¥è¾“å…¥ä¸ª webpack åœ¨å½“å‰ç›®å½•ä¸‹ï¼Œå°±æ˜¯ä¸€åˆ‡éƒ½ç”¨é»˜è®¤çš„

```
webpack
```

å°±å¯ä»¥ç”¨äº†ã€‚

- **å¦‚æœæˆ‘ä¸æƒ³ç”¨é»˜è®¤çš„å’‹åŠï¼Œä½ å¯ä»¥å‘½ä»¤è¡ŒæŒ‡å®š**

```bash
webpack cli --output-path # æŒ‡å®šè¾“å‡ºçš„path
webpack cli --output-filename # æŒ‡å®šè¾“å‡ºçš„æ–‡ä»¶å
webpack cli --entry # æŒ‡å®šè¾“å…¥
```

è¦ä½¿ç”¨ Webpack å‘½ä»¤è¡Œæ›´æ”¹è¾“å…¥çš„æ–‡ä»¶åå’Œè·¯å¾„ï¼Œéœ€è¦åœ¨ webpack å‘½ä»¤åæ·»åŠ ç›¸åº”çš„å‚æ•°ã€‚ä»¥ä¸‹æ˜¯å‡ ä¸ªå¸¸ç”¨çš„å‚æ•°ï¼š

- `--entry <entry>`ï¼šæŒ‡å®šå…¥å£æ–‡ä»¶çš„è·¯å¾„ã€‚
- `--output-filename <filename>`ï¼šæŒ‡å®šè¾“å‡ºæ–‡ä»¶çš„æ–‡ä»¶åã€‚
- `--output-path <path>`ï¼šæŒ‡å®šè¾“å‡ºæ–‡ä»¶çš„è¾“å‡ºç›®å½•ã€‚

ä¾‹å¦‚ï¼Œè¦å°† `src/index.js` ä½œä¸ºå…¥å£æ–‡ä»¶ï¼Œå°†ç¼–è¯‘åçš„æ–‡ä»¶è¾“å‡ºåˆ° `dist` ç›®å½•ä¸‹çš„ `bundle.js` æ–‡ä»¶ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š

```bash
webpack --entry src/index.js --output-filename bundle.js --output-path dist
```

å…¶ä¸­ï¼Œ`--entry` å‚æ•°æŒ‡å®šäº†å…¥å£æ–‡ä»¶è·¯å¾„ä¸º `src/index.js`ï¼Œ`--output-filename` å‚æ•°æŒ‡å®šäº†è¾“å‡ºæ–‡ä»¶åä¸º `bundle.js`ï¼Œ`--output-path` å‚æ•°æŒ‡å®šäº†è¾“å‡ºç›®å½•ä¸º `dist`ã€‚

- **ä¸Šé¢çš„æ¯æ¬¡éƒ½è¦å†™è¿™ä¹ˆé•¿çš„å‘½ä»¤è¡Œæˆ‘ä¸æƒ³ç”¨æ€ä¹ˆåŠï¼Ÿ**

webpack è¿˜æ”¯æŒåœ¨é…ç½®æ–‡ä»¶(`webpack.config.js`)ä¸­è®¾ç½®å…¥å£å’Œè¾“å‡ºï¼Œè¿™æ ·å¯ä»¥æ›´æ–¹ä¾¿åœ°ç®¡ç†å¤šä¸ªæ–‡ä»¶å’Œæ–‡ä»¶å¤¹ã€‚å¯ä»¥åœ¨é…ç½®æ–‡ä»¶ä¸­è®¾ç½® `entry` å±æ€§å’Œ `output` å±æ€§ï¼Œç„¶åé€šè¿‡ `--config` å‚æ•°æŒ‡å®šé…ç½®æ–‡ä»¶è·¯å¾„ï¼Œä½¿ç”¨ä»¥ä¸‹å‘½ä»¤è¿è¡Œ

```bash
webpack # è¾“å…¥è¿™ä¸ªå‘½ä»¤é»˜è®¤å°±æ˜¯ webpack.config.js
# ä¸æƒ³ç”¨webpack.config.jså¯ä»¥æ”¹  âš ï¸ä½†æ˜¯å°½é‡ä¸è¦æ”¹ï¼
webpack  --config web.config.js
```

é…ç½®æ–‡ä»¶è¿™æ ·å†™

```js
// é¡¹ç›®ç›®å½•webpack.config.js

const path = require('path');
// NodeJSç¯å¢ƒ é»˜è®¤æ˜¯commonjsæ¨¡å—ç®¡ç†
module.exports = {
  // è¾“å…¥
  entry: './src/main.js',
  // è¾“å‡º
  output: {
    filename: 'bundle.js',
    // è¿™é‡Œå¿…é¡»è¦ç”¨ç»å¯¹è·¯å¾„ æ‰€ä»¥ä½¿ç”¨äº†path.resolve()è¿™ä¸ªç³»ç»Ÿå‡½æ•° å…·ä½“ä¸çŸ¥é“å»ChatGPT
    path: path.resolve(__dirname, 'dist'),
  },
};
```

## 1. å…·ä½“å¼€å§‹

### ä¸€åˆ‡çš„å¼€å§‹

webpack ä»å“ªé‡Œå¼€å§‹å‘¢ï¼Ÿç­”æ¡ˆå°±æ˜¯ä»å…¥å£æ–‡ä»¶å¼€å§‹ï¼Œç„¶åç”Ÿæˆä¸€ä¸ªä¾èµ–å…³ç³»å›¾ã€‚é€šè¿‡è¿™ä¸ªä¾èµ–å…³ç³»å›¾æ¥æŸ¥æ‰¾ï¼ˆjs,css,image ç­‰ç­‰æ–‡ä»¶ï¼‰ï¼Œéå†è¿™ä¸ªå›¾ç»“æ„ã€‚ä»è€Œå¼€å§‹æ‰“åŒ…æˆä¸€ä¸ªä¸ªæ¨¡å—ã€‚

**å…¥å£ â†’ ä¾èµ–å…³ç³»å›¾ â†’ å„ç§èµ„æº â†’ éå†å…³ç³»å›¾ â†’ è§£æå…³ç³»å›¾ â†’ æ‰“åŒ…æˆå•ç‹¬çš„æ¨¡å—**

æ‰€ä»¥è¯´ä¸€åˆ‡éƒ½æ˜¯ä» entryï¼Œå¼€å§‹ã€‚ğŸ‘‡ğŸ» å¼€å§‹å†™ä¸€ä¸ªå¤„ç† css çš„ä½œä¸ºä¾‹å­

### 1-1. å¤„ç† css

ç”±äº webpack é»˜è®¤åªä¼šå¤„ç† jsï¼Œæ‰€ä»¥å½“ä½ æœ‰å…¶ä»–æ–‡ä»¶çš„æ—¶å€™ï¼Œæ¯”å¦‚ cssã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ css æ˜¯å¿…é¡»å†™åœ¨ html é‡Œçš„

```html
<!DOCTYPE html>
<html lang="en">
  <head>
    <!--  ä¸‹é¢è¿™ç§æ„Ÿè§‰ æ­£å¸¸csséƒ½æ˜¯è¿™æ ·çš„ -->
    <link rel="stylesheet" href="style.css" />
    <script src="./dist/bundle.js"></script>
  </head>
  <body></body>
</html>
```

å¯æ˜¯å½“ä½¿ç”¨å·¥å‚åŒ–ä¹‹åï¼Œå¹¶ä¸æ˜¯ç›´æ¥åœ¨ html æ–‡ä»¶é‡Œå¼•å…¥ cssï¼Œè€Œæ˜¯åœ¨å…¥å£çš„ js æ–‡ä»¶é‡Œå¼•å…¥ï¼Œæ¯”å¦‚ä¸‹é¢è¿™ç§

```js
â”œâ”€â”€ dist
â”‚   â””â”€â”€ bundle.js
â”œâ”€â”€ index.html â†’ æ¨¡æ¿html
â”œâ”€â”€ package-lock.json
â”œâ”€â”€ package.json
â”œâ”€â”€ src
â”‚   â”œâ”€â”€ css
â”‚   â”‚   â””â”€â”€ style.css
â”‚   â””â”€â”€ main.js // åœ¨è¿™é‡Œå¼•å…¥style.css
â””â”€â”€ webpack.config.js
```

ä¹Ÿå°±æ˜¯è¿™ç§æ„Ÿè§‰

```js
// src/main.js
import './css/style.css';

const add = (x, y) => {
  return x + y;
};

console.log('aaaa');
```

å¯æ˜¯é»˜è®¤ webpack åªä¼šå¤„ç† jsï¼Œä¸ä¼šå¤„ç† css å•Šã€‚é‚£æ€ä¹ˆåŠå‘¢ï¼Ÿ

å„ç§ loader å°±ç™»åœºäº†ã€‚æŒ‰ç…§ä¸‹é¢çš„æ­¥éª¤

1. å®‰è£… css-loader `npm i css-loader -D`
2. å†™é…ç½®æ–‡ä»¶`webpack.config.js`

```js
const path = require('path');
// NodeJSç¯å¢ƒ é»˜è®¤æ˜¯commonjsæ¨¡å—ç®¡ç†
module.exports = {
  // è¾“å…¥
  entry: './src/main.js',
  // è¾“å‡º
  output: {
    filename: 'bundle.js',
    // è¿™é‡Œå¿…é¡»è¦ç”¨ç»å¯¹è·¯å¾„ æ‰€ä»¥ä½¿ç”¨äº†path.resolve()è¿™ä¸ªç³»ç»Ÿå‡½æ•° å…·ä½“ä¸çŸ¥é“å»ChatGPT
    path: path.resolve(__dirname, 'dist'),
  },
  //***************é‡ç‚¹çœ‹è¿™é‡Œ******************
  module: {
    // è¿™é‡Œä¸ºä»€ä¹ˆç”¨æ•°ç»„ï¼Œå› ä¸ºå¯èƒ½æœ‰å¤šä¸ªloader
    rules: [
      {
        test: /\.css$/,
        // è¿™é‡Œä¸ºä»€ä¹ˆç”¨æ•°ç»„ï¼Œå› ä¸ºå¯èƒ½1ä¸ªç±»å‹ éœ€è¦å¤šé‡loaderæ¥å¤„ç†
        use: [{ loader: 'css-loader' }],
      },
    ],
  },
  //****************é‡ç‚¹çœ‹è¿™é‡Œ*****************
};
```

3. å®‰è£… style-loader `npm i style-loader -D`

ä¸ºä»€ä¹ˆè¿˜è¦ç»§ç»­å®‰è£…è¿™ä¸ªï¼Œéš¾é“ css-loader ä¸å¤Ÿä¹ˆï¼Ÿä¸å¤Ÿçš„ï¼Œcss-loader åªè´Ÿè´£è§£æ cssï¼Œå¹¶ä¸è´Ÿè´£å±•ç¤ºåˆ°é¡µé¢ html ä¸Šå»ã€‚æ‰€ä»¥è¿˜è¦è¿½åŠ  style-loader

4. å†™é…ç½®æ–‡ä»¶`webpack.config.js`

```js
module: {
  // è¿™é‡Œä¸ºä»€ä¹ˆç”¨æ•°ç»„ï¼Œå› ä¸ºå¯èƒ½æœ‰å¤šä¸ªloader
  rules: [
    {
      test: /\.css$/,
      // è¿™é‡Œä¸ºä»€ä¹ˆç”¨æ•°ç»„ï¼Œå› ä¸ºå¯èƒ½1ä¸ªç±»å‹ éœ€è¦å¤šé‡loaderæ¥å¤„ç†
      // useloaderé¡ºåºæ˜¯ä»åå‘å‰çš„ï¼Œæ‰€ä»¥å…ˆç”¨css-loaderï¼Œåœ¨ç”¨style-loader
      use: [{ loader: 'style-loader' }, { loader: 'css-loader' }],
    },
  ],
},
```

> âš ï¸ ä»å³å‘å·¦æŒ‰ç…§é¡ºåºï¼Œæ‰€ä»¥è¦å…ˆ css è§£æï¼Œç„¶å style è§£æ

å…³äºç®€å†™

**å¦‚æœå¤„ç†æŸä¸ªæ–‡ä»¶åªç”¨åˆ°äº† 1 ä¸ª loaderï¼Œå¯ä»¥ä¸å†™ use ç›´æ¥ loader**

```js
// before
module: {
  rules: [
    {
      test: /\.css$/,
      use: [{ loader: 'style-loader' }],
    },
  ],
},
// after ğŸ†•
module: {
  rules: [
    {
      test: /\.css$/,
      loader: 'style-loader'
    },
  ],
},
```

å¦‚æœ loader æ²¡æœ‰`options:{}`æƒ…å†µä¸‹ï¼Œå¯ä»¥ç›´æ¥å†™

```js
// before
use: [{ loader: 'style-loader',options:{} }, { loader: 'css-loader' }],
// after ğŸ†•
use: ['style-loader', 'css-loader'],
```

åŒç†çš„è¯ï¼Œä¹Ÿå¯ä»¥å†™ä¸€ä¸ªå¤„ç† scss çš„é…ç½®æ–‡ä»¶

å®‰è£… è¦è®°å¾—å¿…é¡»å®‰è£… loader å’Œ sass

```js
npm install sass-loader sass -D
```

ä¿®æ”¹é…ç½®æ–‡ä»¶

```js
{
    test: /\.s[ac]ss$/i,
    // è¿™é‡Œä¸ºä»€ä¹ˆæŒ‰ç…§è¿™ä¸ªé¡ºåºå‘¢ï¼Ÿ
    // sasså¤„ç†è½¬æ¢æˆcss ç„¶åå†å¤„ç†css ç„¶åæ’å…¥style
    use: ['style-loader', 'css-loader', 'sass-loader'],
  },
```

ä½ å¯ä»¥å†™ä¸€ä¸ª scss æ–‡ä»¶è¯•ä¸€ä¸‹

```scss
// src/css/style.scss
$body-color: red;

body {
  background-color: $body-color;
  h2 {
    color: blue;
  }
}
```

#### css å…¼å®¹æ€§é—®é¢˜

å¾ˆå¤š css å±æ€§å¿…é¡»éœ€è¦æµè§ˆå™¨å‰ç¼€æ‰èƒ½è¢«è¯†åˆ«ï¼Œå¿…é¡»ä½ è¦è‡ªå·±å†™ï¼Œä½†æ˜¯æœ‰äº† webpack ä¹‹åï¼Œä½ å®Œå…¨å¯ä»¥ä¸ç”¨å†™äº†ã€‚

é‚£ webpack æ€ä¹ˆæ‰çŸ¥é“é‚£äº›éœ€è¦åŠ ä¸Šå‰ç¼€å“ªäº›ä¸éœ€è¦å‘¢ï¼Ÿæœ‰æ²¡æœ‰ä¸€ç§å·¥å…·è‡ªåŠ¨åŠ å‘¢ï¼Ÿæœ‰çš„ï¼**postcssï¼**

æ€ä¹ˆç”¨å‘¢ï¼Ÿå®‰è£…èµ°èµ·

```js
npm i postcss-loader -D
```

> âš ï¸ å› ä¸ºæ·»åŠ å‰ç¼€è¿™ä¸ªæ˜¯ä¸€ä¸ªæ–°åŠŸèƒ½ï¼Œå¹¶ä¸å•å•åªæ˜¯ä¸€ä¸ª loaderï¼Œæ‰€ä»¥è¿˜éœ€è¦å¦ä¸€ä¸ªåŒ…æ¥è¿›è¡Œæ·»åŠ æ–°åŠŸèƒ½ã€‚

```js
 npm i autoprefixer -D
```

#### æ’ä»¶å’Œ loader åŒºåˆ«

è‡³äºæ’ä»¶å’Œ loader æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Œè¿™ç‚¹æˆ‘å»é—®äº† ChatGPTï¼æˆ‘è§‰å¾—å›ç­”çš„è¿˜ä¸é”™ï¼Œå°±æˆªå›¾ä¸‹æ¥äº†ã€‚

é‡ç‚¹å°±æ˜¯ï¼Œ**æºä»£ç è½¬æ¢ï¼ˆè®©æ–‡ä»¶èƒ½ç”¨ï¼‰ç”¨ loaderï¼Œæ‰©å±•åŠŸèƒ½å°±æ˜¯æ’ä»¶**ï¼

![](https://raw.githubusercontent.com/chihokyo/image_host/develop/image-20230227234130286.png)

ç„¶åå°±æ˜¯å†™é…ç½®æ–‡ä»¶

```js
{
  test: /\.css$/,
  // è¿™é‡Œä¸ºä»€ä¹ˆç”¨æ•°ç»„ï¼Œå› ä¸ºå¯èƒ½1ä¸ªç±»å‹ éœ€è¦å¤šé‡loaderæ¥å¤„ç†
  // useloaderé¡ºåºæ˜¯ä»åå‘å‰çš„ï¼Œæ‰€ä»¥å…ˆç”¨css-loaderï¼Œåœ¨ç”¨style-loader
  use: [
    'style-loader',
    'css-loader',
    // é‡ç‚¹åœ¨è¿™é‡Œ
    {
      loader: 'postcss-loader',
      // â­ï¸è¿™é‡Œè¦å†™options âš ï¸ å…¶å®è¿™äº›è§„åˆ™éƒ½æ˜¯æ’ä»¶è‡ªå·±å®šä¹‰çš„ å’Œwebpackå·²ç»å…³ç³»ä¸å¤§äº†
      options: {
        // å¯¼å…¥æ’ä»¶
        postcssOptions: {
          plugins: ['autoprefixer'],
        },
      },
    },
  ],
},
```

å¦‚æœä½ è§‰å¾—ä¸Šé¢å†™çš„ä¸€å¨é…ç½®æ–‡ä»¶å®åœ¨å¤ªç¹çäº†ï¼Œwebpack ä¹Ÿæ”¯æŒæŠŠ postcss çš„é…ç½®æ–‡ä»¶å†™åœ¨å¤–é¢

```js
module.exports = {
  module: {
    rules: [
      {
        test: /\.css$/,
        use: ['style-loader', 'css-loader', 'postcss-loader'],
      },
    ],
  },
};
```

æ–°å»ºä¸€ä¸ª`postcss.config.js` åå­—ä¸èƒ½æ”¹ã€‚å½“å‘ç°ä¸Šé¢æ²¡æœ‰å†™é…ç½®æ–‡ä»¶çš„æƒ…å†µä¸‹ï¼Œå°±ä¼šæ¥æ‰¾è¿™ä¸ªé…ç½®æ–‡ä»¶ã€‚

```js
module.exports = {
  plugins: [require('autoprefixer')],
};
```

> ä½†æ˜¯è¿™é‡Œæ¨èä½¿ç”¨ postcss-preser-env è¿™ä¸ªæ’ä»¶ pluginsï¼Œä»£æ›¿ autoprefixerã€‚å› ä¸ºè¿™ä¸ªæ›´å¼ºå¤§ï¼Œä¸ä»…å†…ç½®äº† autoprefixerï¼Œè¿˜æœ‰æ–°ç‰¹æ€§ã€‚

ä½¿ç”¨æ–¹æ³•å¾ˆç®€å•

```js
npm i postcss-preser-env -D
```

ç„¶åæŠŠé…ç½®æ–‡ä»¶ç›´æ¥æ”¹æˆè¿™ä¸ªå°±å¯ä»¥

```js
module.exports = {
  plugins: [
    require('postcss-preser-env'): // æœ€æ–°çš„å¯ä»¥çœç•¥require,ç›´æ¥å†™ä¸ª'postcss-preser-env'
  ]
}
```

### 1-2. å¤„ç†å›¾ç‰‡

webpack5 ä¹‹å‰ä½ éƒ½è¦è‡ªå·±æ loaderï¼Œä½†æ˜¯ 5 ä¹‹å webpack å·²ç»å†…ç½®äº†å¤„ç†è¿™äº›å›¾ç‰‡ loaderã€‚å…ˆè¯´ä¸€ä¸‹ä»¥å‰ï¼Œä»¥å‰çš„è¯éœ€è¦è¿™å‡ ä¸ªåŒ…ã€‚ï¼ˆç°åœ¨ä¸éœ€è¦äº†ï¼Œä½†å†…ç½®ä¹Ÿæ˜¯åŸºäºä»¥å‰çš„åŒ…ã€‚

æ—©æœŸå¤„ç†å›¾ç‰‡åŒ…ï¼ˆwebpack5 ä¹‹å‰ï¼‰

- `file-loader`
- `url-loader`
- `raw-loader`

ç°åœ¨çš„è¯[å®˜æ–¹ asset æ–‡æ¡£](https://webpack.js.org/guides/asset-modules/)

```javascript
{
  test: /\.(png|jpe?g|png|svg)$/,
  type: 'asset', // ç›´æ¥åœ¨typeè¿™é‡Œå†™ç±»å‹
},
```

- asset/resource â†’ ç›´æ¥å½“æˆå•ç‹¬æ–‡ä»¶ï¼ˆå…¶å®å°±æ˜¯å¤åˆ¶ç²˜è´´äº†ä¸€å¹¶ä¸”å‘é€äº†ä¸€æ¬¡ url è¯·æ±‚ â†’ **é€‚åˆå¤§ size çš„å›¾ æ¶ˆè€—æ—¶é—´é•¿**
- asset/inline â†’ ä½¿ç”¨ base64 çš„ç¼–ç ï¼Œå¹¶ä¸”ç›´æ¥ç¼–ç åæ”¾åœ¨ js æ–‡ä»¶ä¸­ã€‚ä½†æ˜¯ä¼šé€ æˆ js è§£ææ—¶é—´è¿‡é•¿ï¼Œæ‰€ä»¥ â†’ å° size å›¾éƒ½ç”¨è¿™ä¸ªæ–¹æ³• å› ä¸ºç›´æ¥åµŒå…¥åˆ° js é‡Œçš„ data:image ä»£ç ä¸ä¼šé˜»å¡
- asset/source â†’ å¯¼å‡ºæºä»£ç ï¼ˆå¾ˆå°‘ç”¨ï¼Œå±äºäºŒè¿›åˆ¶
- asset â†’ åŒ…å«äº† asset/resource å’Œ asset/inline å¯ä»¥é…ç½®èµ„æºä½“ç§¯

é‚£æˆ‘å¦‚ä½•è®©å¤§çš„èµ„æº`asset/resource `ç”¨è¿™ä¸ªï¼Œå°çš„èµ„æºç”¨`asset/inline `å‘¢ï¼Ÿ

```js
{
    test: /\.(png|jpe?g|gif|svg)$/,
    type: 'asset',
      // è®¾ç½®è¿™ä¸ª
    parser: {
      // ä¸è¶…è¿‡60kbçš„å°±å¯ä»¥ç”¨data:imageåµŒå…¥jsçš„æ–¹å¼
      dataUrlCondition: {
        maxSize: 60 * 1024,
      },
    },
  },
```

é‚£å¦‚æœæˆ‘æƒ³é‡å‘½åå‘¢ï¼Ÿ

```js
generator: {
    // å ä½ç¬¦
    // name åŸæ¥æ–‡ä»¶åå­—
    // ext æ‹“å±•åå­—
    // hash å“ˆå¸Œå€¼ å¦‚æœè§‰å¾—å¤ªé•¿ å¯ä»¥æˆªå–[hash:7]
    // è¿™é‡Œä¼šæå‰ç”Ÿæˆæ–‡ä»¶å¤¹
    filename: 'static/[name][hash:7][ext]',
  },
```

### 1-3. å¤„ç† JS

è¿™ä¸ªæ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿä¸æ˜¯è¯´é»˜è®¤å¯ä»¥å¤„ç† JS å—ï¼Ÿå…¶å®ä¸»è¦æ˜¯å°† es6 è½¬æ¢æˆ es5 ä»£ç ï¼Œä¸»è¦ç”¨çš„æ˜¯ babel æ’ä»¶ã€‚

ä»€ä¹ˆæ˜¯ babel å‘¢ï¼Ÿâ†’ ç”¨æ³•å¤ªå¤šï¼Œä»¥åå¯ä»¥å•ç‹¬å†™ä¸€ä¸‹ã€‚ä½†æ˜¯ç°åœ¨åªè®²å¦‚ä½•åœ¨ webpack ç”¨ babelã€‚

ä½†æ’ä»¶éœ€è¦ä»¥ä¸‹è¿™ä¹ˆå¤šï¼

```js
npm i @babel/cli @bable/core -D
```

æ‰€ä»¥ç›´æ¥ç”¨é¢„è®¾çš„ bable å°±å¯ä»¥

```js
npm i babel-loader -D
npm i @babel/preset-env -D
```

å†™é…ç½®

```js
// webpack.config.js
{
  test: /\.js$/,
  use: ['babel-loader'],
},
```

å†™å•ç‹¬çš„ babel é…ç½®

```js
// babel.config.js
module.exports = {
  presets: ['@babel/preset-env'],
};
```

babel è¿˜æœ‰å…¶ä»–é¢„è®¾ã€‚ä¸»è¦æœ‰ env,react,typescript è¿™ä¸ªå¯ä»¥æŸ¥æ‰¾ã€‚

## 2. resolve æ¨¡å—è§£æ

è¿™ä¸ªé…ç½®å°±æ˜¯ä¸»ç®¡å„ç§è·¯å¾„è§£æçš„ã€‚

è¿™ä¸ªæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿé‚£å°±æ˜¯ä½ åœ¨å†™ä»£ç çš„æ—¶å€™ä¼šå¼•å…¥å„å¼å„æ ·çš„æ¨¡å—ã€‚å°±æ˜¯

```js
require('module');
```

ä»¥å‰åœ¨æ¨¡å—åŒ–çš„æ—¶å€™æ˜¯æœ‰è§„åˆ™çš„ï¼Œä½†å…¶å® webpack å…¶å®ä¹Ÿæœ‰è§„åˆ™

### è§„åˆ™

- ç»å¯¹è·¯å¾„ â†’ å·²ç»éƒ½æ˜¯ç»å¯¹çš„äº† ä¸ç”¨è§£æ
- ç›¸å¯¹è·¯å¾„ â†’ ä½¿ç”¨ import å’Œ require çš„ä¼šè®¤ä¸ºæ˜¯ä¸Šä¸‹æ–‡ç›®å½•ï¼Œç„¶åç»™ç›¸å¯¹è·¯å¾„ï¼Œæ‹¼æ¥æˆç»å¯¹è·¯å¾„ã€‚
- æ¨¡å—ç›®å½• â†’ ä¼šä» resolve.modules æŒ‡å®šçš„æ‰€æœ‰ç›®å½•è¿›è¡Œæ£€ç´¢ã€‚é»˜è®¤æ˜¯`[node_modules]`

### ç¡®å®šæ˜¯æ–‡ä»¶è¿˜æ˜¯æ–‡ä»¶å¤¹

å¦‚æœæ˜¯ä¸€ä¸ªæ–‡ä»¶

- æœ‰æ‰©å±•åï¼Œç›´æ¥æ‰“åŒ…ã€‚æ¯”å¦‚ js
- æ²¡æœ‰çš„è¯ï¼Œå°±ç”¨`resolve.extensions`é€‰é¡¹ä½œä¸ºæ‰©å±•åè§£æã€‚è¿™ä¹Ÿå°±æ˜¯ä¸ºä»€ä¹ˆå³ä½¿ä½ å¼•å…¥çš„æ˜¯`jsx`,`vue`ï¼Œä½ æ²¡æœ‰å†™åç¼€åã€‚ä¹Ÿå¯ä»¥è¢«è¯†åˆ«æ‰“åŒ…çš„åŸå› ã€‚

å¦‚æœæ˜¯ä¸€ä¸ªæ–‡ä»¶å¤¹

- `resolve.mainFiles`é»˜è®¤å€¼æ˜¯

é…ç½®

```js
resolve: {
    extensions: ['.js', '.json', '.jsx', 'vue']  // å°±æŒ‰ç…§è¿™ä¸ªé¡ºåº
},
```

é…ç½®åˆ«åï¼Œä¸ºäº†é˜²æ­¢ä½ å¼•å…¥æ¨¡å—çš„æ—¶å€™ã€‚`require("../../è¿™æ ·ä¸€å¤§å¨")`

```js
resolve: {
  extensions: ['.js', '.json', '.jsx'],
  alias: {
    '@': path.resolve(__dirname, './src/utils'),
  },
},
```

## 3. Plugins å„ç§æ’ä»¶

ä¸Šé¢è¯´äº†ä¸€ä¸‹ loader å’Œæ’ä»¶çš„åŒºåˆ«ã€‚æ‰€ä»¥æ¥ä¸‹æ¥è®²ä¸€ä¸‹å¸¸ç”¨çš„æ’ä»¶ã€‚

### CleanWebpackPlugin

æ¸…é™¤çš„ï¼Œæ¯æ¬¡æ‰“åŒ…åå…ˆç»™ä½ æŠŠè€çš„æ‰€æœ‰æ–‡ä»¶ç»™åˆ æ‰ã€‚ç„¶åé‡æ–°æ‰“åŒ…ã€‚é˜²æ­¢ä½ çš„ç›®å½•ä¸€å †ä¸ç”¨çš„è€åƒåœ¾ã€‚

ä½†æ˜¯è¿™ä¸ªæ’ä»¶ç°åœ¨å·²ç»è¢«**å†…ç½®é…ç½®**ä»£æ›¿äº†

```js
// è¾“å‡º
output: {
  filename: 'bundle.js',
  path: path.resolve(__dirname, 'dist'),
  // ç›´æ¥ç”¨è¿™ä¸ªé…ç½®å°±è¡Œ
  clear: true,
},
```

### HtmlWebpackPlugin

ä½ æ¯æ¬¡æ‰“åŒ…ä¹‹åï¼Œdist æ‰“åŒ…åçš„æ–‡ä»¶å¤¹é‡Œæ ¹æœ¬æ²¡æœ‰ html æ–‡ä»¶çš„ã€‚æ¯æ¬¡éƒ½æ˜¯åœ¨å¤–é¢çš„ã€‚éš¾é“ä½ æ¯æ¬¡éƒ½è¦è‡ªå·±æ‰‹åŠ¨è½¬å…¥åˆ°æ‰“åŒ…åçš„ dist æ–‡ä»¶å¤¹é‡Œé¢å—ã€‚

è¿™æ ·å¾ˆä¸ä¸“ä¸šï¼Œä¹Ÿä¸è§„èŒƒã€‚

```js
.
â”œâ”€â”€ README.md
â”œâ”€â”€ babel.config.js
â”œâ”€â”€ dist
â”‚   â””â”€â”€ bundle.js
â”œâ”€â”€ index.html // è¿™ä¸ªæ¯æ¬¡éƒ½åœ¨å¤–é¢å¾ˆä¸ä¸“ä¸š
â”œâ”€â”€ package-lock.json
â”œâ”€â”€ package.json
â”œâ”€â”€ postcss.config.js
â”œâ”€â”€ src
â”‚   â”œâ”€â”€ css
â”‚   â”‚   â”œâ”€â”€ style.css
â”‚   â”‚   â””â”€â”€ style.scss
â”‚   â”œâ”€â”€ img
â”‚   â”‚   â”œâ”€â”€ image_demo.png
â”‚   â”‚   â””â”€â”€ small.png
â”‚   â””â”€â”€ main.js
â””â”€â”€ webpack.config.js
```

è¿™ä¸ªæ’ä»¶å°±æ˜¯è‡ªåŠ¨åœ¨ dist ç»™ä½ è‡ªåŠ¨ç”Ÿæˆæ–‡ä»¶çš„ã€‚æ¯æ¬¡ä½ å°±ä¸ç”¨è‡ªå·±åœ¨å¤–é¢å†™ `index.html`äº†ã€‚

ä½†æ˜¯ä»–è‡ªå·±ç»™ä½ å†™çš„ htmlã€‚ä½ ä¸æ˜¯å¾ˆæ»¡æ„æ€ä¹ˆåŠï¼Ÿ

```js
npm i html-webpack-plugin -D // å…ˆå®‰è£…
```

ç„¶åé…ç½®é‡Œç›´æ¥å†™

```js
plugins: [new HtmlWebpackPlugin()],
```

å¦‚æœä½ è§‰å¾— title ä¸æ»¡æ„

```js
plugins: [
  new HtmlWebpackPlugin({
    title: 'æˆ‘å–çš„åå­—',
  }),
],
```

å¦‚æœä½ è§‰å¾—æ•´ä¸ª index ä½ éƒ½ä¸æ»¡æ„ï¼Œå¯ä»¥ç”¨è‡ªå·±å†™çš„æ¨¡æ¿ã€‚

```js
plugins: [
  new HtmlWebpackPlugin({
    title: 'æˆ‘å–çš„åå­—',
    template: './index.html',
  }),
],
```

### DefinePlugin

è¿™ä¸ªåšä»€ä¹ˆå‘¢ï¼Ÿä½ ä»”ç»†çœ‹ react æ¨¡æ¿çš„è¯ï¼Œä¼šå‘ç°æœ‰ä¸€ä¸ªè°œä¹‹å˜é‡`%PUBLIC_URL%`ã€‚è·Ÿä¸€äº›æ¨¡æ¿å¼•æ“å¾ˆåƒã€‚

```html
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <link rel="icon" href="%PUBLIC_URL%/favicon.ico" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
</html>

```

è¿™ä¸ªå°±æ˜¯ EJS æ¨¡æ¿å¡«å……æ•°æ®ï¼Œå±äº**å…¨å±€å˜é‡**ã€‚é‚£æ€ä¹ˆè®¾ç½®å‘¢ï¼Ÿ

webpack å†…ç½®çš„æ’ä»¶`DefinePlugin`

```js
// å¼•å…¥
const { DefinePlugin } = require('webpack');

plugins: [
  new HtmlWebpackPlugin({
    title: 'æˆ‘å–çš„åå­—',
    template: './index.html',
  }),
  // ä¹¦å†™
  new DefinePlugin({
    BASE_URL: "'./'",
  }),
],
```

> âš ï¸ è¿™é‡Œæœ‰ä¸ªè¦æ³¨æ„çš„ï¼Œ` BASE_URL: "'./'",`åé¢çš„åŒå¼•å·é‡Œé¢çš„ä»£ç ä¼šè¢«è§£ææˆ js ä»£ç ï¼Œç±»ä¼¼äº`eval()`
>
> æ‰€ä»¥ä½ ç›´æ¥å†™`BASE_URL: "./",` çš„è¯ï¼Œ`./`ä¼šè¢«è¯¯è®¤æˆä¸º JS ä»£ç ã€‚æ‰€ä»¥åŒ…è£¹äº†ä¸€å±‚ã€‚

```html
<!DOCTYPE html>
<html lang="en">
  <head>
   <!-- è¿™é‡Œå°±èƒ½ç”¨äº† -->
    <link rel="stylesheet" href="<%= BASE_URL %>" />
</html>

```

è€Œä¸”ä½ ä¸ä»…ä»…èƒ½å†™åœ¨ html é‡Œï¼Œä»»ä½•ä¸€ä¸ª js æ–‡ä»¶ã€‚éƒ½å¯ä»¥ä½¿ç”¨è¿™ä¸ªå…¨å±€å˜é‡

```js
console.log(BASE_URL); // éšä¾¿åœ¨å“ªé‡Œéƒ½èƒ½ç›´æ¥ç”¨
```

## 4. mode

è¿™ä¸ªé…ç½®ï¼Œæ˜¯å¯ä»¥å‘Šè¯‰ webpack ä½¿ç”¨ç›¸åº”æ¨¡å¼çš„å†…ç½®ä¼˜åŒ–ã€‚

æ€»å…±æœ‰ 3 ç§æ¨¡å¼ã€‚

- none â†’ ä¸ä½¿ç”¨ä»»ä½•é»˜è®¤ä¼˜åŒ–
- development â†’ æ¯”å¦‚ä¼šæœ‰æºç å¯ä»¥æŸ¥çœ‹ã€‚
- production é»˜è®¤ â†’ æ¯”å¦‚ä¼šæœ‰æ··æ·†ï¼Œä¸‘åŒ–ï¼Œç­‰ç­‰ã€‚

![image-20230302222318229](https://raw.githubusercontent.com/chihokyo/image_host/develop/image-20230302222318229.png)

### åŒºåˆ†å¼€å‘çº¿ä¸Šç¯å¢ƒ

é‚£ä¹ˆå¦‚ä½•åŒºåˆ†å¼€å‘ development/production ç¯å¢ƒå‘¢ï¼Ÿ

æ–¹æ³•ä¸€

æ–°å¢ä¸€ä¸ªæ–‡ä»¶å¤¹ï¼Œç„¶ååˆ†åˆ«å†™

```js
.
â”œâ”€â”€ README.md
â”œâ”€â”€ babel.config.js
â”œâ”€â”€ config
â”‚   â”œâ”€â”€ webpack.dev.config.js
â”‚   â””â”€â”€ webpack.pro.config.js
```

ç„¶åä½ åœ¨`package.json` åˆ†åˆ«å†™ä¸Šè¿™ä¸ª

```js
"scripts": {
  "test": "echo \"Error: no test specified\" && exit 1",
  "serve": "webpack serve --config ./config/webpack.dev.config.js",
  "build": "webpack --config ./config/webpack.pro.config.js"
},
```

> âš ï¸ï¼Œæ­¤å¤„æœ‰ä¸ªæ³¨æ„ç‚¹ï¼Œå…¥å£æ–‡ä»¶çš„è·¯å¾„æ°¸è¿œæ˜¯ç›¸å½“äº webpack å¯åŠ¨å‘½ä»¤çš„ã€‚
>
> å…¶å®æœ¬è´¨æ˜¯ç›¸å½“äº context å±æ€§

```js
module.exports = {
  // entryæ˜¯ç›¸å½“äºè¿™ä¸ªç›®å½•çš„ã€‚ä½†è¿™ä¸ªæå°‘æ”¹å˜ï¼Œä¸€å¾‹éƒ½ç”¨é»˜è®¤çš„
  context: path.resolve(__dirname, '/'),
  // æ°¸è¿œæ˜¯ç›¸å½“äºwebpackå¯åŠ¨ï¼Œä¹Ÿå°±æ˜¯æ ¹è·¯å¾„
  entry: './src/main.js',
};
```

é‚£å¦‚æœæˆ‘ä»¬æƒ³æœ‰ä¸€ä¸ªå…±é€šçš„ï¼Œç„¶ååˆ†åˆ«è®¾ç½® dev å’Œ pro å‘¢ï¼Ÿ

å®‰è£…ä¸€ä¸ªåŒ…`webpack-merge`

```js
npm i webpack-merge -D
```

ç„¶åä¿®æ”¹é…ç½®æ–‡ä»¶ï¼Œå¢åŠ ä¸€ä¸ªå…±é€šçš„é…ç½®

```js
â”œâ”€â”€ config
â”‚   â”œâ”€â”€ webpack.com.config.js // å…±é€šçš„
â”‚   â”œâ”€â”€ webpack.dev.config.js
â”‚   â””â”€â”€ webpack.pro.config.js
```

```js
const { merge } = require('webpack-merge'); // å¯¼å…¥æ’ä»¶
const comConfig = require('./webpack.com.config'); // å¯¼å…¥å…±é€š
// devé…ç½®
module.exports = merge(comConfig, {
  // devçš„ä¸“å±é…ç½®
});
```

## 5. æ­å»ºæœ¬åœ°æœåŠ¡å™¨

ç›®å‰çš„è¯æ˜¯æ²¡æœ‰æœ¬åœ°æœåŠ¡å™¨çš„ï¼Œä½ å†™çš„æ¯æ¬¡éƒ½æ˜¯è¦ç”¨ live server è¿™ä¸ªæ’ä»¶çš„ã€‚ä¹Ÿæ²¡æœ‰çƒ­æ›´æ–°ï¼Œä¹Ÿéœ€è¦æ‰‹åŠ¨æ‰“åŒ…ã€‚

ä¸ºäº†æˆ‘ä»¬æ¯ä¸€æ¬¡å¯ä»¥è‡ªåŠ¨é‡æ–°ç¼–è¯‘+å¯ä»¥è‡ªå·±æ‰“å¼€`index.html`

é‚£ä¹ˆå¦‚æœæˆ‘ä»¬æœ¬åœ°éœ€è¦ä¸€ä¸ªæœåŠ¡å™¨æ€ä¹ˆåŠï¼Ÿéœ€è¦ä¸€ä¸ªæ’ä»¶ã€‚`devServer`

**å®‰è£…ä½¿ç”¨**

```js
// å®‰è£…
npm i webpack-dev-server -D

// ä»€ä¹ˆéƒ½ä¸ç”¨é…ç½® ç›´æ¥è¾“å…¥å‘½ä»¤è¡Œè¿è¡Œ
npx webpack serve
```

> è¿™æ ·å°±å¯ä»¥ç›´æ¥ç”¨äº†ã€‚ä½†æ˜¯ç”¨è¿™ä¸ªä¹‹åï¼Œä¼šå‘ç°å°±ä¸ä¼šç»™ä½ æ‰“åŒ…äº†ï¼ˆä¸ä¼šç”Ÿæˆ distï¼Œä¸ä¼šè¾“å‡ºä»»ä½•æ–‡ä»¶ï¼‰ï¼Œè¿™ä¸ªä¼šç›´æ¥ç»™ä½ åŠ è½½åˆ°å†…å­˜é‡Œï¼Œç›´æ¥è¿è¡Œã€‚

è€Œä¸”ä½ ä¼šå‘ç°ä¼šç»™ä½ è¾“å‡ºé»˜è®¤ 8080 ç«¯å£æ‰“å¼€ã€‚

**çƒ­æ¨¡å—æ›´æ–°**

å¯æ˜¯è¿™æ ·ä¿®æ”¹äº†ä¸€ä¸ªæ–‡ä»¶ï¼Œä¼šå¯¼è‡´å…¨éƒ¨éƒ½è¢«åˆ·æ–°ï¼Œäºæ˜¯å°±æœ‰äº† HMRã€‚çƒ­æ¨¡å—æ›´æ–° hot module replacementã€‚

å°±æ˜¯è¿è¡Œè¿‡ç¨‹ä¸­ï¼Œæ›¿æ¢æ·»åŠ åˆ é™¤æ¨¡å—ï¼Œä¸éœ€è¦åˆ·æ–°æ•´ä¸ªç½‘é¡µã€‚

å¦‚ä½•é…ç½®ï¼Ÿå…¶å®é»˜è®¤æ˜¯æ‰“å¼€çš„ã€‚

```js
mode: 'development',
decServer: {
  hot: true,
},
```

ä½†åªæ˜¯è¿™æ ·æ˜¯ä¸å¤Ÿçš„ï¼Œè¿™ä¸ªåªæ˜¯å¼€å¯äº†çƒ­æ›´æ–°æ¨¡å¼ã€‚è‡³äºä½ æƒ³è®©å“ªä¸ªæ¨¡å—çƒ­æ›´æ–°ï¼Œéœ€è¦ä½ è‡ªå·±å†™

```js
if (module.hot) {
  // demo.jsæ˜¯éœ€è¦ä½ æ›´æ–°çš„
  module.hot.accept('./demo.js');
}
```

> éš¾é“æˆ‘æ‰€æœ‰æ–‡ä»¶è¿˜è¦ 1 ä¸ªä¸ªå†™å—ï¼Ÿ
>
> çœŸå®å¼€å‘çš„æ—¶å€™å…¶å®ä¸ç”¨ä½ å†™ï¼Œæ¡†æ¶ react ç­‰ç­‰ä¼šç»™ä½ é…ç½®å¥½çš„ã€‚

**ä¿®æ”¹ host/port ç«¯å£**

é»˜è®¤æ˜¯ 8080ï¼Œæƒ³è¦å…¶ä»–çš„ã€‚

```js
mode: 'development',
decServer: {
  hot: true,
    // è¿™é‡Œä¿®æ”¹
  port:8787;
},
```

ä½ ä¹Ÿå¯ä»¥ä¿®æ”¹

```js
mode: 'development',
decServer: {
  hot: true,
    // è¿™é‡Œä¿®æ”¹
  port:8787,
  host:0.0.0.0, // è¿™é‡Œå¯ä»¥æ”¹host
  open:true, // è‡ªåŠ¨æ‰“å¼€æµè§ˆå™¨
  compress:true // å‹ç¼©æˆgzip èŠ‚çœä¼ è¾“èµ„æº
},
```
